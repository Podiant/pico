!function(n){"function"==typeof define&&define.amd?define(n):n()}((function(){"use strict";function n(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function e(n,e){for(var t=0;t<e.length;t++){var a=e[t];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(n,a.key,a)}}function t(n,t,a){return t&&e(n.prototype,t),a&&e(n,a),n}function a(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),e&&r(n,e)}function i(n){return(i=Object.setPrototypeOf?Object.getPrototypeOf:function(n){return n.__proto__||Object.getPrototypeOf(n)})(n)}function r(n,e){return(r=Object.setPrototypeOf||function(n,e){return n.__proto__=e,n})(n,e)}function o(n){if(void 0===n)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function c(n,e){return!e||"object"!=typeof e&&"function"!=typeof e?o(n):e}var s=function(){function e(){n(this,e),this.__callbacks={}}return t(e,[{key:"on",value:function(n,e){return void 0===this.__callbacks[n]&&(this.__callbacks[n]=[]),this.__callbacks[n].push(e),this}},{key:"off",value:function(n,e){var t=this.__callbacks[n];if(void 0===t)return this;var a=[];if(void 0!==e)for(var i=0;i<t.length;i++)t[i]!==e&&a.push(t[i]);return this.__callbacks[n]=a,this}},{key:"emit",value:function(n){var e=this.__callbacks[n],t=Array.from(arguments).slice(1);if(void 0!==e)for(var a=0;a<e.length;a++)e[a].apply(this,t);return this}}]),e}(),d=function(e){function r(e){var t,a=e.plugins,s=e.views;return n(this,r),(t=c(this,i(r).call(this))).__plugins=[],t.__views=[],Array.isArray(a)&&a.forEach((function(n){var e=new n(o(t));t.__plugins.push(e)})),Array.isArray(s)&&s.forEach((function(n){var e=new n(o(t));t.__views.push(e)})),t.$=window.$,t.$(document).ready((function(){t.ready()})),t}return a(r,e),t(r,[{key:"ready",value:function(){var n=this.$("body");this.__views.forEach((function(e){var t=e.classNames(),a=!1;t.forEach((function(e){a||n.hasClass(e)||(a=!0)})),a||e.ready()})),this.emit("ready")}}]),r}(s),u=function(e){function r(e){var t;return n(this,r),(t=c(this,i(r).call(this))).app=e,e.on("ready",t.ready),t}return a(r,e),t(r,[{key:"ready",value:function(){}}]),r}(s),l=function(e){function r(){return n(this,r),c(this,i(r).apply(this,arguments))}return a(r,e),t(r,[{key:"check",value:function(n){var e=this;return new Promise((function(t,a){e.emit("validating"),e.validate(n).then((function(n){e.emit("valid"),t(n)})).catch((function(n){e.emit("invalid",n),a(n)}))}))}},{key:"validate",value:function(){throw new Error("Method not implemented")}}]),r}(s),f=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,h=function(e){function r(){return n(this,r),c(this,i(r).apply(this,arguments))}return a(r,e),t(r,[{key:"validate",value:function(n){return new Promise((function(e,t){var a=String(n).toLowerCase();f.test(a)?e(a):t(new Error("This doesn't look like an email address."))}))}}]),r}(l),v=function(e){function r(e){var t;return n(this,r),(t=c(this,i(r).call(this))).basis=e,t}return a(r,e),t(r,[{key:"validate",value:function(n){var e=this;return new Promise((function(t,a){var i=new WebSocket("ws://".concat(window.location.host,"/ws/unique/").concat(e.basis,"/")),r=!1,o=!1;i.onclose=function(){o||r||a(new Error("An error occurred while communicating with the server."))},i.onmessage=function(e){var c=JSON.parse(e.data);c.valid?o||r||(r=!0,i.close(),t(n)):o||r||(o=!0,i.close(),a(new Error(c.error)))},i.onopen=function(){i.send(n)}}))}}]),r}(l),p=function(e){function r(e){var t;return n(this,r),(t=c(this,i(r).call(this))).checkAgainst=e,t}return a(r,e),t(r,[{key:"validate",value:function(n){var e=this;return new Promise((function(t,a){n!==e.checkAgainst?a(new Error("This value doesn't match the previous one.")):t(n)}))}}]),r}(l),w=function(e){function r(e){var t;return n(this,r),(t=c(this,i(r).call(this))).basis=e,t}return a(r,e),t(r,[{key:"validate",value:function(n){var e=this;return new Promise((function(t,a){var i=new WebSocket("ws://".concat(window.location.host,"/ws/validate/").concat(e.basis,"/")),r=!1,o=!1;i.onclose=function(){o||r||a(new Error("An error occurred while communicating with the server."))},i.onmessage=function(e){var c=JSON.parse(e.data);c.valid?o||r||(r=!0,i.close(),t(n)):o||r||(o=!0,i.close(),a(new Error(c.error)))},i.onopen=function(){i.send(n)}}))}}]),r}(l),m=function(e){function t(e,a){var r;n(this,t),r=c(this,i(t).call(this));r.show=function(n){return new Promise((function(e){a.hasClass("active")&&(r.emit("shown"),e()),r.emit("showing"),n?a.addClass("showing-"+n):a.addClass("showing"),setTimeout((function(){n?a.removeClass("showing-"+n):a.removeClass("showing"),r.emit("shown"),e()}),333)}))},r.hide=function(n){return new Promise((function(e){r.emit("hiding"),n?a.addClass("hiding-"+n):a.addClass("hiding"),setTimeout((function(){n?a.removeClass("hiding-"+n):a.removeClass("hiding"),r.emit("hidden"),e()}),333)}))},r.on("showing",(function(){a.addClass("active"),a.trigger("wizard.showing")})),r.on("hidden",(function(){a.removeClass("active"),a.trigger("wizard.hidden")})),r.on("shown",(function(){a.find(":input").first().focus(),a.trigger("wizard.shown")})),r.on("validation",(function(n){if(void 0===n)return a.find(":input.is-invalid").removeClass("is-invalid"),void a.find(".invalid-feedback").remove();var e=window.$(n.field),t=e.closest(".form-group"),i=t.find(".invalid-feedback");e.addClass("is-invalid"),i.length||(i=window.$("<div>").addClass("invalid-feedback")).appendTo(t),i.text(n.message),e.focus()})),r.prev=function(){r.hide("rw").then((function(){r.emit("moving.prev"),r.emit("prev")}))},r.next=function(){var n,e,t;n=a.find('button, input[type="button"]').attr("disabled","disabled"),e=a.find(":input").not(n).not("[disabled]"),t=function(){n.removeAttr("disabled"),e.removeAttr("disabled")},e.attr("disabled","disabled"),r.on("moving.next",t),r.on("validation",(function(n){n&&t()})),r.emit("validation"),r.validate().then((function(){r.emit("moving.next"),r.hide("ff").then((function(){r.emit("next")}))})).catch((function(n){r.emit("validation",n)}))},r.validate=function(){return new Promise((function(n,e){var t=!1,i=[],r=a.closest("form");a.find(":input").each((function(){if(t)return!1;var n=window.$(this),a=n.val(),o=n.attr("required"),c=n.attr("type")||"text",s=n.attr("data-unique"),d=n.attr("data-validator"),u=n.attr("data-pair");if(o&&!a.trim())return t=!0,e({field:n,message:"This field is required."}),!1;switch(c){case"email":i.push([new h,n])}s&&i.push([new v(s),n]),d&&i.push([new w(d),n]),u&&i.push([new p(r.find(':input[name="'.concat(u,'"]')).val()),n])}));i.length?function a(){var r=i.shift(),o=r[0],c=r[1],s=c.val().trim();o.check(s).then((function(){i.length?a():t||n()})).catch((function(n){t||(t=!0,e({field:c,message:n.message}))}))}():t||n()}))};var s=o(r);return a.on("click",'[data-action="prev"]',(function(){s.prev()})),a.on("click","[data-skip]",(function(){var n=parseInt(window.$(this).data("skip"));s.hide("ff"),s.emit("skip",n)})),a.on("click",'[data-action="next"]',(function(){s.next()})),a.on("keydown",":input",(function(n){13===n.keyCode&&(n.preventDefault(),s.next())})),r}return a(t,e),t}(s),b=function(e){function t(e){var a;n(this,t);var r=o(a=c(this,i(t).call(this))),s=[];return e.find(".step").each((function(){var n=window.$(this),e=new m(r,n);n.data("wizard-step",e),s.push(e)})),s.forEach((function(n,e){e>0&&n.on("moving.prev",(function(){s[e-1].show("rw")})),e<s.length-1?n.on("moving.next",(function(){s[e+1].show("ff")})):n.on("next",(function(){a.submit()})),n.on("skip",(function(n){s[n].show("ff")}))})),a.show=function(n){void 0===n&&(n=0),e.find(".step").each((function(e){if(window.$(this).find(".form-group.is-invalid").length)return n=e,!1})),s[n].show()},a.submit=function(){e.closest("form").submit()},a}return a(t,e),t}(s),g=function(e){function r(){return n(this,r),c(this,i(r).apply(this,arguments))}return a(r,e),t(r,[{key:"ready",value:function(){var n=this.$;n(".wizard").each((function(){new b(n(this)).show()}))}}]),r}(u),y=function(e){function t(e){var a;n(this,t),a=c(this,i(t).call(this));var r=e.find('input[type="file"]'),s=r.attr("accept"),d=o(a),u=function(n){if(s){var e=new RegExp("^"+s.replace("/","\\/").replace("*",".*"));if(!n.type.match(e))return!1}return!0};return e.on("dragenter",(function(n){n.preventDefault(),e.addClass("active"),a.emit("drag.enter")})).on("dragleave",(function(n){n.preventDefault(),e.removeClass("active"),a.emit("drag.exit")})).on("dragover",(function(n){n.preventDefault(),e.addClass("active"),a.emit("drag.over")})).on("drop",(function(n){if(n.preventDefault(),1===n.originalEvent.dataTransfer.files.length){var e=0;for(e=0;e<n.originalEvent.dataTransfer.files.length;e++)if(!u(n.originalEvent.dataTransfer.files[e]))return void a.emit("error",new Error("The dragged file was not of the correct type."));n.originalEvent.dataTransfer.files&&(r.get(0).files=n.originalEvent.dataTransfer.files,r.trigger("change"))}})).on("click",(function(n){n.target!==r.get(0)&&(n.preventDefault(),r.get(0).click())})),r.on("change",(function(){var n=0;for(n=0;n<this.files.length;n++)d.emit("file",this.files[n])})),a}return a(t,e),t}(s),k=function(e){function t(e){var a;return n(this,t),(a=c(this,i(t).call(this,e))).on("error",(function(){alert("Only images are supported here.")})),a.on("file",(function(n){var t=new FileReader;t.onload=function(n){e.css("background-image","url(".concat(n.target.result,")"))},t.readAsDataURL(n)})),a}return a(t,e),t}(y),C=function(e){function r(){return n(this,r),c(this,i(r).apply(this,arguments))}return a(r,e),t(r,[{key:"ready",value:function(){var n=this.$;n(".dropzone").each((function(){var e=n(this);e.hasClass("dropzone-image")?new k(e):new y(e)}))}}]),r}(u),E=function(n,e){void 0===e&&(e=333);var t=null,a=[],i=function(){n.apply(n,a),t=null};return function(){for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];a=r,null===t&&(t=setTimeout(i,e))}},$=function(e){function t(e){var a;return n(this,t),(a=c(this,i(t).call(this))).data=e,a.attach=function(n){var t=window.$("<a>").addClass("typeahead-item").addClass("list-group-item").attr("href","javascript:;");if(e.thumbnail){var i=window.$("<div>").addClass("d-flex w-100"),r=window.$("<img>").attr("src",e.thumbnail).attr("height","30").addClass("mr-3"),o=window.$("<span>").text(e.label);r.appendTo(i),o.appendTo(i),i.appendTo(t)}else t.text(e.label);t.on("click",(function(){a.select()})),t.appendTo(n),a.focus=function(){t.addClass("active").addClass("list-item-active"),a.emit("focused")},a.blur=function(){t.removeClass("active").removeClass("list-item-active"),a.emit("blurred")},a.select=function(){t.addClass("active").addClass("list-item-active"),a.emit("selected")}},a.focus=function(){throw new Error("List item not attached to container DOM element.")},a.blur=function(){throw new Error("List item not attached to container DOM element.")},a}return a(t,e),t}(s),_=function(e){function t(e){var a;return n(this,t),(a=c(this,i(t).call(this))).attach=function(n){var t=window.$("<div>").addClass("typeahead-container").addClass("list-group"),i=n.offset(),r=null,o=[];e.forEach((function(n,e){var i=new $(n);i.index=e,i.on("focused",(function(){r!==i&&(null!==r&&r.blur(),r=i)})),i.on("selected",(function(){a.emit("selected",i)})),o.push(i),i.attach(t)})),t.css({position:"absolute",top:i.top+n.outerHeight(!0),left:i.left,width:n.outerWidth(!0)}),window.$("body").append(t),a.detatch=function(){t.remove()},a.moveUp=function(){var n=null;null!==r&&(n=r.index),n=null===n?e.length-1:Math.max(0,n-1),a.focus(n)},a.moveDown=function(){var n=null;null!==r&&(n=r.index),n=null===n?0:Math.min(e.length-1,n+1),a.focus(n)},a.focus=function(n){if(void 0===n)throw new Error("Expected index of item to select.");void 0!==o[n]?o[n].focus():(null!==r&&r.blur(),r=null)},a.select=function(){null!==r&&r.select()}},a.detatch=function(){throw new Error("List has not been attached to a DOM element.")},a}return a(t,e),t}(s),x=function(e){function t(e,a,r){var o;n(this,t),o=c(this,i(t).call(this));var s=e.attr("name"),d=window.$("<input>").attr("name",s).attr("type","hidden");e.removeAttr("name"),e.after(d);var u=new E((function(n){var t=a.replace("%s",encodeURIComponent(n));window.$.getJSON(t,(function(n){var t=r(n),a=new _(t);e.data("typeahed-list")&&e.data("typeahed-list").detatch(),o.on("move.up",(function(){a.moveUp()})),o.on("move.down",(function(){a.moveDown()})),o.on("select",(function(){a.select()})),a.on("selected",(function(n){d.val(n.data.id),e.val(n.data.label),a.detatch(),e.focus()})),a.attach(e),e.data("typeahed-list",a)}))}),900);return e.on("input",(function(){return u(e.val())})),e.on("keydown",(function(n){switch(n.keyCode){case 40:n.preventDefault(),o.emit("move.down");break;case 38:n.preventDefault(),o.emit("move.up");break;case 13:d.val()||(n.preventDefault(),n.stopPropagation(),o.emit("select"))}})),o}return a(t,e),t}(s),z=function(n){var e=n.indexOf(".$."),t=n.substr(0,e),a=n.substr(e+3);return function(n,e){var i=e[t][n];if(void 0===i)throw new Error("Index out of range.");return i[a]}},D=function(n){var e=n.indexOf(".$."),t=n.substr(0,e);return function(n){var e=n[t];if(Array.isArray(e))return e.length;throw new Error("Value is not an array.")}},O=function e(t){n(this,e),this.transform=function(n){var e=t.id,a=t.label,i=t.thumbnail,r=e?new z(e):null,o=a?new z(a):null,c=i?new z(i):null,s=new D(e),d=0;if(!r)throw new Error("No template provided for returning an object ID.");if(!o)throw new Error("No template provided for returning an object label.");try{d=s(n)}catch(n){throw new Error("Invalid data returned.")}var u,l,f=0,h=[];for(f=0;f<d;f++)h.push((u=f,l=void 0,(l={}).id=r(u,n),l.label=o(u,n),c&&(l.thumbnail=c(u,n)),l));return h}},j=function(e){function r(){return n(this,r),c(this,i(r).apply(this,arguments))}return a(r,e),t(r,[{key:"ready",value:function(){var n=this.$;n("input[data-typeahead-url]").each((function(){var e=n(this),t=e.data("typeahead-url"),a=new O(e.data("typeahead-transform")),i=new x(e,t,a.transform);e.removeAttr("data-typeahead-url"),e.removeAttr("data-typeahead-transform"),e.data("typeahead",i)}))}}]),r}(u),A=function(e){function r(e){var t;return n(this,r),(t=c(this,i(r).call(this))).app=e,t}return a(r,e),t(r,[{key:"classNames",value:function(){return[]}}]),t(r,[{key:"ready",value:function(){}}]),r}(s),T=function(e){function r(){return n(this,r),c(this,i(r).apply(this,arguments))}return a(r,e),t(r,[{key:"classNames",value:function(){return["projects","create-project"]}},{key:"ready",value:function(){var n=this.app.$,e=n('input[name="name"]'),t=n("#id_apple_podcasts_id");t.closest(".step").on("wizard.shown",(function(){t.val()&&t.trigger("input")})),e.on("change",(function(){t.val(e.val())}))}}]),r}(A),P=function(e){function t(e,a){var r;n(this,t);var o=null,s=null,d=!1;(r=c(this,i(t).call(this))).connect=function(){o=new WebSocket(e);var n=function(n,e,t){var a={meta:window.$.extend({method:n},t),data:e},i=JSON.stringify(a);o.send(i)};r.create=function(e){return n("create",e)},r.update=function(e){return n("update",e)},r.update_list=function(e,t){return n("update_list",t,{type:e})},r.delete=function(e){return n("delete",e)},r.list=function(e){return n("list",e)},o.onclose=function(){o=null,u(),d&&(d=!1,r.emit("disconnected")),s=setTimeout((function(){a*=2,r.connect()}),a),console.warn("Waiting ".concat(a/1e3," second(s) for connection to be restored."))},o.onmessage=function(n){var e=JSON.parse(n.data);if(e.error)console.warn(e.error);else if(e.meta){switch(e.meta.method){case"list":return void r.emit("listed",e.meta.type,e.data);case"create":return void r.emit("created",e.meta.type,e.data);case"update":return void r.emit("updated",e.meta.type,e.data);case"update_list":return void r.emit("listed",e.meta.type,e.data);case"delete":return void r.emit("deleted",e.meta.type,e.data)}console.warn("Unrecognised response.",e.meta)}else console.warn("Missing response metadata.")},o.onopen=function(){null!==s&&(clearTimeout(s),s=null),d||(d=!0,r.emit("connected"))}};var u=function(){void 0===a&&(a=1e3),r.create=function(){throw new Error("Database not connected.")},r.update=function(){throw new Error("Database not connected.")},r.update_list=function(){throw new Error("Database not connected.")},r.delete=function(){throw new Error("Database not connected.")},r.list=function(){throw new Error("Database not connected.")},r.send=function(){throw new Error("Database not connected.")}};return u(),r}return a(t,e),t}(s),q=function(e){function r(e){var t;n(this,r),(t=c(this,i(r).call(this))).accepted=!1,t.rejected=!1,t.cancelled=!1,console.debug("Requesting to add a card in",e.name);var a=setTimeout((function(){t.cancel()}),1e4);return t.on("accepted",(function(){clearTimeout(a)})),t.on("rejected",(function(){clearTimeout(a)})),t}return a(r,e),t(r,[{key:"accept",value:function(n){if(this.accepted||this.rejected||this.cancelled)throw new Error("Request is in an invalid state.");this.accepted=!0,this.emit("accepted",n)}},{key:"reject",value:function(){if(this.accepted||this.rejected||this.cancelled)throw new Error("Request is in an invalid state.");this.rejected=!0,this.emit("rejected")}},{key:"cancel",value:function(){if(this.accepted||this.rejected||this.cancelled)throw new Error("Request is in an invalid state.");this.cancelled=!0,this.emit("cancelled")}}]),r}(s),R=function(e){function t(){var e;return n(this,t),(e=c(this,i(t).call(this))).actions={},e.attach=function(n){var t=window.$("<div>").addClass("kanban-card card mb-3"),a=window.$("<div>").addClass("card-body");if(t.append(a),n.append(t),e.populate(a),Object.keys(e.actions).length){var i=window.$("<div>").addClass("card-footer text-right");Object.keys(e.actions).forEach((function(n){var t=e.actions[n],a=window.$("<a>").attr("href","javascript:;"),r=window.$("<i>").addClass("fa fa-".concat(t.icon||n));a.on("click",(function(e){e.preventDefault(),t.perform().then((function(e){console.debug("Performed",n,e)})).catch((function(e){console.warn("Error performing",n,e)}))})),a.addClass("text-muted"),a.append(r),i.append(a)})),t.append(i)}return e.detatch=function(){t.remove(),e.detatch=function(){throw new Error("Card has not been attached to a DOM element.")},e.freeze=function(){throw new Error("Card has not been attached to a DOM element.")},e.unfreeze=function(){throw new Error("Card has not been attached to a DOM element.")},e.emit("detatched")},e.freeze=function(){t.addClass("kanban-frozen")},e.unfreeze=function(){t.removeClass("kanban-frozen")},t},e.populate=function(){},e.cancel=function(){e.emit("cancelled")},e.submit=function(n){e.emit("submitted",n)},e.detatch=function(){throw new Error("Card has not been attached to a DOM element.")},e.freeze=function(){throw new Error("Card has not been attached to a DOM element.")},e.unfreeze=function(){throw new Error("Card has not been attached to a DOM element.")},e}return a(t,e),t}(s),M=function(e){function t(e){var a;return n(this,t),(a=c(this,i(t).call(this,e))).populate=function(n){var t=window.$("<input>").attr("type","text").addClass("form-control");e.placeholder&&t.attr("placeholder",e.placeholder),t.on("keyup",(function(n){switch(n.keyCode){case 27:a.cancel();break;case 13:n.preventDefault(),a.submit(t.val())}})),n.append(t),t.focus()},a}return a(t,e),t}(R),S=function(e){function t(e){var a;return n(this,t),(a=c(this,i(t).call(this,e))).id=e.id,a.ordering=e.ordering,a.actions={delete:{icon:"trash",title:"Delete card",perform:function(){return new Promise((function(n,e){confirm("Are you sure?")?a.destroy().then((function(){n(!0)})).catch((function(n){e(n)})):n(!1)}))}}},a.populate=function(n){var t=window.$("<a>").attr("href",e.url).text(e.name);n.append(t)},a.destroy=function(){return new Promise((function(n){a.emit("destroy",n)}))},a.move=function(n,e){a.freeze(),a.emit("send",n,e)},a.update=function(n){e=n,a.ordering=n.ordering,a.name=n.name},a}return a(t,e),t}(R),N=function(e){function t(e,a){var r;n(this,t),(r=c(this,i(t).call(this))).id=a.id,r.name=a.name,r.on("attached",(function(){e.trigger("kanban.attached")})),r.on("cards.create.request",(function(){e.trigger("kanban.cards.create.request")}));var s=window.$("<h6>").text(a.name),d=window.$("<div>").addClass("kanban-list-container"),u=window.$("<div>").addClass("kanban-list-footer");if(a.can_create_cards){var l=window.$("<button>").addClass("btn btn-outline-primary btn-block mb-3").text("Add card");l.on("click",(function(n){if(n.preventDefault(),!l.attr("disabled")&&a.can_create_cards){var e=new q(o(r));e.on("accepted",(function(n){var e=new M(n);e.on("submitted",(function(n){e.detatch(),r.emit("cards.create.submit",{name:n})})).on("cancelled",(function(){e.detatch()})).on("detatched",(function(){l.removeAttr("disabled")})),e.attach(d)})).on("rejected",(function(n){console.warn("Request rejected.",n),l.removeAttr("disabled")})).on("cancelled",(function(){console.warn("Request was not fulfilled in time."),l.removeAttr("disabled")})),l.attr("disabled","disabled"),r.emit("cards.create.request",e)}})),u.append(l)}return e.append(s),e.append(d),e.append(u),r.canSend=function(){return a.can_move_out},r.canReceive=function(){return a.can_move_in},r.addCard=function(n){n.attach(d).data("kanban-card",n)},r.reorder=function(n){r.emit("cards.reorder",n)},r.redraw=function(){var n={},e={};d.find(".kanban-card").each((function(){var t=window.$(this),a=t.data("kanban-card");n[a.ordering]=t,e[a.ordering]=a,t.remove()}));var t=Object.keys(n);t.sort(),t.forEach((function(t){var a=n[t],i=e[t];a.data("kanban-card",i),d.append(a),i.unfreeze()}))},r}return a(t,e),t}(s),U=function(e){function t(e,a){var r;n(this,t),r=c(this,i(t).call(this));var o=window.$("<div>").addClass("kanban-column-row"),s={},d={};r.on("freeze",(function(){console.debug("Board frozen."),e.find("a[href], button").each((function(){var n=window.$(this);n.data("frozen")||n.attr("disabled")||(n.attr("disabled","disabled"),n.data("frozen",!0))})),e.addClass("kanban-frozen")})).on("unfreeze",(function(){console.debug("Board unfrozen."),e.find("a[href], button").each((function(){var n=window.$(this);n.data("frozen")&&(n.removeAttr("disabled"),n.data("frozen",!1))})),e.removeClass("kanban-frozen")})),e.append(o),r.emit("freeze");var u=function(n){var e=n.attributes.column,t=s[e];if(t){var a=window.$.extend({id:n.id,url:n.links.detail},n.attributes),i=new S(a);i.on("send",(function(n,e){i.freeze(),l.update({type:"cards",id:i.id,attributes:{column:e.id}})})).on("destroy",(function(e){console.debug("Destroying card.",n.id),l.delete({type:"cards",id:n.id}),e()})),t.addCard(i),d[n.id]=i}else console.warn("Could not add card to column",e)},l=new P("ws://".concat(window.location.host,"/ws/kanban/").concat(a,"/"));return l.on("connected",(function(){console.debug("Opened a socket to the Kanban board."),l.list({type:"columns"})})).on("disconnected",(function(){console.warn("Kanban board socket closed unexpectedly."),r.emit("error"),r.emit("freeze")})).on("listed",(function(n,e){switch(n){case"columns":return void function(n){console.debug(n),o.html("").css({width:0}),n.forEach((function(n){var e=window.$("<div>").addClass("kanban-column"),t=new N(e,window.$.extend({id:n.id},n.attributes));t.on("cards.create.request",(function(n){r.emit("cards.create.request",n,t)})).on("cards.create.submit",(function(e){l.create({type:"cards",attributes:window.$.extend({column:n.id},e)})})).on("cards.reorder",(function(n){var e=[];n.forEach((function(n,t){e.push({type:"cards",id:n,attributes:{ordering:t}})})),l.update_list("cards",e)})),s[n.id]=t,n.cards.forEach(u),e.data("kanban-column",t),o.append(e),t.emit("attached");var a=e.outerWidth(!0);o.width(o.width()+a+15)})),o.find(".kanban-column").on("drop",(function(n,e){var t=e.draggable.data("kanban-card"),a=e.draggable.closest(".kanban-column").data("kanban-column"),i=window.$(this),r=i.data("kanban-column");return null==t?(console.warning("Lost the card object."),!1):a.canSend(t)&&r.canReceive(t)?(i.removeClass("kanban-can-receive").removeClass("kanban-cannot-receive"),void t.move(a,r)):(i.removeClass("kanban-can-receive").removeClass("kanban-cannot-receive"),!1)})).on("dropover",(function(n,e){var t=e.draggable,a=t.data("kanban-card"),i=t.closest(".kanban-column"),r=i.data("kanban-column"),o=window.$(this),c=o.data("kanban-column");return!i.is(o)&&(r.canSend(a)&&c.canReceive(a)?void o.addClass("kanban-can-receive").removeClass("kanban-cannot-receive"):(o.removeClass("kanban-can-receive").addClass("kanban-cannot-receive"),!1))})).on("dropout",(function(){window.$(this).removeClass("kanban-can-receive").removeClass("kanban-cannot-receive")})).droppable(),o.find(".kanban-list-container").on("sortstart",(function(n,e){e.placeholder.height(e.item.height())})).on("sortupdate",(function(){var n=window.$(this).closest(".kanban-column").data("kanban-column"),e=[];window.$(this).find(".kanban-card").each((function(){var n=window.$(this).data("kanban-card");n.freeze(),e.push(n.id)})),n.reorder(e)})).sortable({placeholder:"ui-sortable-placeholder mb-3"}),r.emit("unfreeze")}(e);case"cards":return void function(n){var e={};n.forEach((function(n){var t=d[n.id];if(t.update(n.attributes),void 0!==t){var a=n.attributes.column,i=s[a];void 0!==i?e[a]=i:console.warn("Can't find column ".concat(a))}})),Object.values(e).forEach((function(n){n.redraw()}))}(e)}console.warn("Unrecognised content type.",n)})).on("created",(function(n,e){switch(n){case"cards":return void u(e)}console.warn("Unrecognised content type.",n)})).on("updated",(function(n,e){switch(n){case"cards":return void function(n){var e=d[n.id];if(void 0!==e){var t=s[n.attributes.column];e.update(n.attributes),e.detatch(),void 0!==t&&t.addCard(e)}}(e)}console.warn("Unrecognised content type.",n)})).on("deleted",(function(n,e){switch(n){case"cards":return void function(n){var e=d[n];e?e.detatch():console.warn("Could not find card with ID ".concat(n,"."))}(e.id)}console.warn("Unrecognised content type.",n)})),l.connect(),r}return a(t,e),t}(s),I=function(e){function r(){return n(this,r),c(this,i(r).apply(this,arguments))}return a(r,e),t(r,[{key:"classNames",value:function(){return["projects","board-detail"]}},{key:"ready",value:function(){var n=this.app.$;n(".kanban-board[data-id]").each((function(){var e=n(this),t=new U(e,e.data("id"));t.on("cards.create.request",(function(n){n.accept({placeholder:"Episode title"})})),e.removeAttr("data-id"),e.data("kanban-board",t)}))}}]),r}(A);window.Pico=new d({plugins:[g,C,j],views:[T,I]})}));
//# sourceMappingURL=pico.js.map