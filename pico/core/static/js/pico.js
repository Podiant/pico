!function(n){"function"==typeof define&&define.amd?define(n):n()}((function(){"use strict";function n(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function")}function t(n,t){for(var e=0;e<t.length;e++){var i=t[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,i.key,i)}}function e(n,e,i){return e&&t(n.prototype,e),i&&t(n,i),n}function i(n,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(t&&t.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),t&&r(n,t)}function a(n){return(a=Object.setPrototypeOf?Object.getPrototypeOf:function(n){return n.__proto__||Object.getPrototypeOf(n)})(n)}function r(n,t){return(r=Object.setPrototypeOf||function(n,t){return n.__proto__=t,n})(n,t)}function o(n){if(void 0===n)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function s(n,t){return!t||"object"!=typeof t&&"function"!=typeof t?o(n):t}var u=function(){function t(){n(this,t),this.__callbacks={}}return e(t,[{key:"on",value:function(n,t){return void 0===this.__callbacks[n]&&(this.__callbacks[n]=[]),this.__callbacks[n].push(t),this}},{key:"off",value:function(n,t){var e=this.__callbacks[n];if(void 0===e)return this;var i=[];if(void 0!==t)for(var a=0;a<e.length;a++)e[a]!==t&&i.push(e[a]);return this.__callbacks[n]=i,this}},{key:"emit",value:function(n){var t=this.__callbacks[n],e=Array.from(arguments).slice(1);if(void 0!==t)for(var i=0;i<t.length;i++)t[i].apply(this,e);return this}}]),t}(),c=function(t){function r(t){var e,i=t.plugins,u=t.views;return n(this,r),(e=s(this,a(r).call(this))).__plugins=[],e.__views=[],Array.isArray(i)&&i.forEach((function(n){var t=new n(o(e));e.__plugins.push(t)})),Array.isArray(u)&&u.forEach((function(n){var t=new n(o(e));e.__views.push(t)})),e.$=window.$,e.$(document).ready((function(){e.ready()})),e}return i(r,t),e(r,[{key:"ready",value:function(){var n=this.$("body");this.__views.forEach((function(t){var e=t.classNames(),i=!1;e.forEach((function(t){i||n.hasClass(t)||(i=!0)})),i||t.ready()})),this.emit("ready")}}]),r}(u),l=function(t){function r(t){var e;return n(this,r),(e=s(this,a(r).call(this))).app=t,t.on("ready",e.ready),e}return i(r,t),e(r,[{key:"ready",value:function(){}}]),r}(u),f=function(t){function r(){return n(this,r),s(this,a(r).apply(this,arguments))}return i(r,t),e(r,[{key:"check",value:function(n){var t=this;return new Promise((function(e,i){t.emit("validating"),t.validate(n).then((function(n){t.emit("valid"),e(n)})).catch((function(n){t.emit("invalid",n),i(n)}))}))}},{key:"validate",value:function(){throw new Error("Method not implemented")}}]),r}(u),d=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,h=function(t){function r(){return n(this,r),s(this,a(r).apply(this,arguments))}return i(r,t),e(r,[{key:"validate",value:function(n){return new Promise((function(t,e){var i=String(n).toLowerCase();d.test(i)?t(i):e(new Error("This doesn't look like an email address."))}))}}]),r}(f),v=function(t){function r(t){var e;return n(this,r),(e=s(this,a(r).call(this))).basis=t,e}return i(r,t),e(r,[{key:"validate",value:function(n){var t=this;return new Promise((function(e,i){var a=new WebSocket("ws://".concat(window.location.host,"/ws/unique/").concat(t.basis,"/")),r=!1,o=!1;a.onclose=function(){o||r||i(new Error("An error occurred while communicating with the server."))},a.onmessage=function(t){var s=JSON.parse(t.data);s.valid?o||r||(r=!0,a.close(),e(n)):o||r||(o=!0,a.close(),i(new Error(s.error)))},a.onopen=function(){a.send(n)}}))}}]),r}(f),p=function(t){function r(t){var e;return n(this,r),(e=s(this,a(r).call(this))).checkAgainst=t,e}return i(r,t),e(r,[{key:"validate",value:function(n){var t=this;return new Promise((function(e,i){n!==t.checkAgainst?i(new Error("This value doesn't match the previous one.")):e(n)}))}}]),r}(f),w=function(t){function r(t){var e;return n(this,r),(e=s(this,a(r).call(this))).basis=t,e}return i(r,t),e(r,[{key:"validate",value:function(n){var t=this;return new Promise((function(e,i){var a=new WebSocket("ws://".concat(window.location.host,"/ws/validate/").concat(t.basis,"/")),r=!1,o=!1;a.onclose=function(){o||r||i(new Error("An error occurred while communicating with the server."))},a.onmessage=function(t){var s=JSON.parse(t.data);s.valid?o||r||(r=!0,a.close(),e(n)):o||r||(o=!0,a.close(),i(new Error(s.error)))},a.onopen=function(){a.send(n)}}))}}]),r}(f),m=function(t){function e(t,i){var r;n(this,e),r=s(this,a(e).call(this));r.show=function(n){return new Promise((function(t){i.hasClass("active")&&(r.emit("shown"),t()),r.emit("showing"),n?i.addClass("showing-"+n):i.addClass("showing"),setTimeout((function(){n?i.removeClass("showing-"+n):i.removeClass("showing"),r.emit("shown"),t()}),333)}))},r.hide=function(n){return new Promise((function(t){r.emit("hiding"),n?i.addClass("hiding-"+n):i.addClass("hiding"),setTimeout((function(){n?i.removeClass("hiding-"+n):i.removeClass("hiding"),r.emit("hidden"),t()}),333)}))},r.on("showing",(function(){i.addClass("active"),i.trigger("wizard.showing")})),r.on("hidden",(function(){i.removeClass("active"),i.trigger("wizard.hidden")})),r.on("shown",(function(){i.find(":input").first().focus(),i.trigger("wizard.shown")})),r.on("validation",(function(n){if(void 0===n)return i.find(":input.is-invalid").removeClass("is-invalid"),void i.find(".invalid-feedback").remove();var t=window.$(n.field),e=t.closest(".form-group"),a=e.find(".invalid-feedback");t.addClass("is-invalid"),a.length||(a=window.$("<div>").addClass("invalid-feedback")).appendTo(e),a.text(n.message),t.focus()})),r.prev=function(){r.hide("rw").then((function(){r.emit("moving.prev"),r.emit("prev")}))},r.next=function(){var n,t,e;n=i.find('button, input[type="button"]').attr("disabled","disabled"),t=i.find(":input").not(n).not("[disabled]"),e=function(){n.removeAttr("disabled"),t.removeAttr("disabled")},t.attr("disabled","disabled"),r.on("moving.next",e),r.on("validation",(function(n){n&&e()})),r.emit("validation"),r.validate().then((function(){r.emit("moving.next"),r.hide("ff").then((function(){r.emit("next")}))})).catch((function(n){r.emit("validation",n)}))},r.validate=function(){return new Promise((function(n,t){var e=!1,a=[],r=i.closest("form");i.find(":input").each((function(){if(e)return!1;var n=window.$(this),i=n.val(),o=n.attr("required"),s=n.attr("type")||"text",u=n.attr("data-unique"),c=n.attr("data-validator"),l=n.attr("data-pair");if(o&&!i.trim())return e=!0,t({field:n,message:"This field is required."}),!1;switch(s){case"email":a.push([new h,n])}u&&a.push([new v(u),n]),c&&a.push([new w(c),n]),l&&a.push([new p(r.find(':input[name="'.concat(l,'"]')).val()),n])}));a.length?function i(){var r=a.shift(),o=r[0],s=r[1],u=s.val().trim();o.check(u).then((function(){a.length?i():e||n()})).catch((function(n){e||(e=!0,t({field:s,message:n.message}))}))}():e||n()}))};var u=o(r);return i.on("click",'[data-action="prev"]',(function(){u.prev()})),i.on("click","[data-skip]",(function(){var n=parseInt(window.$(this).data("skip"));u.hide("ff"),u.emit("skip",n)})),i.on("click",'[data-action="next"]',(function(){u.next()})),i.on("keydown",":input",(function(n){13===n.keyCode&&(n.preventDefault(),u.next())})),r}return i(e,t),e}(u),g=function(t){function e(t){var i;n(this,e);var r=o(i=s(this,a(e).call(this))),u=[];return t.find(".step").each((function(){var n=window.$(this),t=new m(r,n);n.data("wizard-step",t),u.push(t)})),u.forEach((function(n,t){t>0&&n.on("moving.prev",(function(){u[t-1].show("rw")})),t<u.length-1?n.on("moving.next",(function(){u[t+1].show("ff")})):n.on("next",(function(){i.submit()})),n.on("skip",(function(n){u[n].show("ff")}))})),i.show=function(n){void 0===n&&(n=0),t.find(".step").each((function(t){if(window.$(this).find(".form-group.is-invalid").length)return n=t,!1})),u[n].show()},i.submit=function(){t.closest("form").submit()},i}return i(e,t),e}(u),y=function(t){function r(){return n(this,r),s(this,a(r).apply(this,arguments))}return i(r,t),e(r,[{key:"ready",value:function(){var n=this.$;n(".wizard").each((function(){new g(n(this)).show()}))}}]),r}(l),b=function(t){function e(t){var i;n(this,e),i=s(this,a(e).call(this));var r=t.find('input[type="file"]'),u=r.attr("accept"),c=o(i),l=function(n){if(u){var t=new RegExp("^"+u.replace("/","\\/").replace("*",".*"));if(!n.type.match(t))return!1}return!0};return t.on("dragenter",(function(n){n.preventDefault(),t.addClass("active"),i.emit("drag.enter")})).on("dragleave",(function(n){n.preventDefault(),t.removeClass("active"),i.emit("drag.exit")})).on("dragover",(function(n){n.preventDefault(),t.addClass("active"),i.emit("drag.over")})).on("drop",(function(n){if(n.preventDefault(),1===n.originalEvent.dataTransfer.files.length){var t=0;for(t=0;t<n.originalEvent.dataTransfer.files.length;t++)if(!l(n.originalEvent.dataTransfer.files[t]))return void i.emit("error",new Error("The dragged file was not of the correct type."));n.originalEvent.dataTransfer.files&&(r.get(0).files=n.originalEvent.dataTransfer.files,r.trigger("change"))}})).on("click",(function(n){n.target!==r.get(0)&&(n.preventDefault(),r.get(0).click())})),r.on("change",(function(){var n=0;for(n=0;n<this.files.length;n++)c.emit("file",this.files[n])})),i}return i(e,t),e}(u),k=function(t){function e(t){var i;return n(this,e),(i=s(this,a(e).call(this,t))).on("error",(function(){alert("Only images are supported here.")})),i.on("file",(function(n){var e=new FileReader;e.onload=function(n){t.css("background-image","url(".concat(n.target.result,")"))},e.readAsDataURL(n)})),i}return i(e,t),e}(b),C=function(t){function r(){return n(this,r),s(this,a(r).apply(this,arguments))}return i(r,t),e(r,[{key:"ready",value:function(){var n=this.$;n(".dropzone").each((function(){var t=n(this);t.hasClass("dropzone-image")?new k(t):new b(t)}))}}]),r}(l),_=function(n,t){void 0===t&&(t=333);var e=null,i=[],a=function(){n.apply(n,i),e=null};return function(){for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];i=r,null===e&&(e=setTimeout(a,t))}},E=function(t){function e(t){var i;return n(this,e),(i=s(this,a(e).call(this))).data=t,i.attach=function(n){var e=window.$("<a>").addClass("typeahead-item").addClass("list-group-item").attr("href","javascript:;");if(t.thumbnail){var a=window.$("<div>").addClass("d-flex w-100"),r=window.$("<img>").attr("src",t.thumbnail).attr("height","30").addClass("mr-3"),o=window.$("<span>").text(t.label);r.appendTo(a),o.appendTo(a),a.appendTo(e)}else e.text(t.label);e.on("click",(function(){i.select()})),e.appendTo(n),i.focus=function(){e.addClass("active").addClass("list-item-active"),i.emit("focused")},i.blur=function(){e.removeClass("active").removeClass("list-item-active"),i.emit("blurred")},i.select=function(){e.addClass("active").addClass("list-item-active"),i.emit("selected")}},i.focus=function(){throw new Error("List item not attached to container DOM element.")},i.blur=function(){throw new Error("List item not attached to container DOM element.")},i}return i(e,t),e}(u),x=function(t){function e(t){var i;return n(this,e),(i=s(this,a(e).call(this))).attach=function(n){var e=window.$("<div>").addClass("typeahead-container").addClass("list-group"),a=n.offset(),r=null,o=[];t.forEach((function(n,t){var a=new E(n);a.index=t,a.on("focused",(function(){r!==a&&(null!==r&&r.blur(),r=a)})),a.on("selected",(function(){i.emit("selected",a)})),o.push(a),a.attach(e)})),e.css({position:"absolute",top:a.top+n.outerHeight(!0),left:a.left,width:n.outerWidth(!0)}),window.$("body").append(e),i.detatch=function(){e.remove()},i.moveUp=function(){var n=null;null!==r&&(n=r.index),n=null===n?t.length-1:Math.max(0,n-1),i.focus(n)},i.moveDown=function(){var n=null;null!==r&&(n=r.index),n=null===n?0:Math.min(t.length-1,n+1),i.focus(n)},i.focus=function(n){if(void 0===n)throw new Error("Expected index of item to select.");void 0!==o[n]?o[n].focus():(null!==r&&r.blur(),r=null)},i.select=function(){null!==r&&r.select()}},i.detatch=function(){throw new Error("List has not been attached to a DOM element.")},i}return i(e,t),e}(u),$=function(t){function e(t,i,r){var o;n(this,e),o=s(this,a(e).call(this));var u=t.attr("name"),c=window.$("<input>").attr("name",u).attr("type","hidden");t.removeAttr("name"),t.after(c);var l=new _((function(n){var e=i.replace("%s",encodeURIComponent(n));window.$.getJSON(e,(function(n){var e=r(n),i=new x(e);t.data("typeahed-list")&&t.data("typeahed-list").detatch(),o.on("move.up",(function(){i.moveUp()})),o.on("move.down",(function(){i.moveDown()})),o.on("select",(function(){i.select()})),i.on("selected",(function(n){c.val(n.data.id),t.val(n.data.label),i.detatch(),t.focus()})),i.attach(t),t.data("typeahed-list",i)}))}),900);return t.on("input",(function(){return l(t.val())})),t.on("keydown",(function(n){switch(n.keyCode){case 40:n.preventDefault(),o.emit("move.down");break;case 38:n.preventDefault(),o.emit("move.up");break;case 13:c.val()||(n.preventDefault(),n.stopPropagation(),o.emit("select"))}})),o}return i(e,t),e}(u),A=function(n){var t=n.indexOf(".$."),e=n.substr(0,t),i=n.substr(t+3);return function(n,t){var a=t[e][n];if(void 0===a)throw new Error("Index out of range.");return a[i]}},O=function(n){var t=n.indexOf(".$."),e=n.substr(0,t);return function(n){var t=n[e];if(Array.isArray(t))return t.length;throw new Error("Value is not an array.")}},T=function t(e){n(this,t),this.transform=function(n){var t=e.id,i=e.label,a=e.thumbnail,r=t?new A(t):null,o=i?new A(i):null,s=a?new A(a):null,u=new O(t),c=0;if(!r)throw new Error("No template provided for returning an object ID.");if(!o)throw new Error("No template provided for returning an object label.");try{c=u(n)}catch(n){throw new Error("Invalid data returned.")}var l,f,d=0,h=[];for(d=0;d<c;d++)h.push((l=d,f=void 0,(f={}).id=r(l,n),f.label=o(l,n),s&&(f.thumbnail=s(l,n)),f));return h}},z=function(t){function r(){return n(this,r),s(this,a(r).apply(this,arguments))}return i(r,t),e(r,[{key:"ready",value:function(){var n=this.$;n("input[data-typeahead-url]").each((function(){var t=n(this),e=t.data("typeahead-url"),i=new T(t.data("typeahead-transform")),a=new $(t,e,i.transform);t.removeAttr("data-typeahead-url"),t.removeAttr("data-typeahead-transform"),t.data("typeahead",a)}))}}]),r}(l),D=function(t){function r(t){var e;return n(this,r),(e=s(this,a(r).call(this))).app=t,e}return i(r,t),e(r,[{key:"classNames",value:function(){return[]}}]),e(r,[{key:"ready",value:function(){}}]),r}(u),P=function(t){function r(){return n(this,r),s(this,a(r).apply(this,arguments))}return i(r,t),e(r,[{key:"classNames",value:function(){return["projects","create-project"]}},{key:"ready",value:function(){var n=this.app.$,t=n('input[name="name"]'),e=n("#id_apple_podcasts_id");e.closest(".step").on("wizard.shown",(function(){e.val()&&e.trigger("input")})),t.on("change",(function(){e.val(t.val())}))}}]),r}(D),j=function(t){function e(t,i){var r;n(this,e),(r=s(this,a(e).call(this))).on("freeze",(function(){console.debug("Board frozen."),t.addClass("kanban-frozen")})).on("unfreeze",(function(){console.debug("Board unfrozen."),t.removeClass("kanban-frozen")})),r.emit("freeze");var o=new WebSocket("ws://".concat(window.location.host,"/ws/kanban/").concat(i,"/"));return o.onclose=function(){console.warn("Kanban board socket closed unexpectedly."),r.emit("error"),r.emit("freeze")},o.onmessage=function(n){var t=JSON.parse(n.data);console.debug("Kanban socket message",t)},o.onopen=function(){console.debug("Opened a socket to the Kanban board."),o.send()},r}return i(e,t),e}(u),N=function(t){function r(){return n(this,r),s(this,a(r).apply(this,arguments))}return i(r,t),e(r,[{key:"classNames",value:function(){return["projects","board-detail"]}},{key:"ready",value:function(){var n=this.app.$;n(".kanban-board[data-id]").each((function(){var t=n(this),e=new j(t,t.data("id"));t.removeAttr("data-id"),t.data("kanban-board",e)}))}}]),r}(D);window.Pico=new c({plugins:[y,C,z],views:[P,N]})}));
//# sourceMappingURL=pico.js.map