!function(t){"function"==typeof define&&define.amd?define(t):t()}((function(){"use strict";function t(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}function n(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function e(t,e,i){return e&&n(t.prototype,e),i&&n(t,i),t}function i(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(n&&n.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),n&&a(t,n)}function r(t){return(r=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function a(t,n){return(a=Object.setPrototypeOf||function(t,n){return t.__proto__=n,t})(t,n)}function o(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function s(t,n){return!n||"object"!=typeof n&&"function"!=typeof n?o(t):n}var u=function(){function n(){t(this,n),this.__callbacks={}}return e(n,[{key:"on",value:function(t,n){return void 0===this.__callbacks[t]&&(this.__callbacks[t]=[]),this.__callbacks[t].push(n),this}},{key:"off",value:function(t,n){var e=this.__callbacks[t];if(void 0===e)return this;var i=[];if(void 0!==n)for(var r=0;r<e.length;r++)e[r]!==n&&i.push(e[r]);return this.__callbacks[t]=i,this}},{key:"emit",value:function(t){var n=this.__callbacks[t],e=Array.from(arguments).slice(1);if(void 0!==n)for(var i=0;i<n.length;i++)n[i].apply(this,e);return this}}]),n}(),c=function(n){function a(n){var e,i=n.plugins,u=n.views;return t(this,a),(e=s(this,r(a).call(this))).__plugins=[],e.__views=[],Array.isArray(i)&&i.forEach((function(t){var n=new t(o(e));e.__plugins.push(n)})),Array.isArray(u)&&u.forEach((function(t){var n=new t(o(e));e.__views.push(n)})),e.$=window.$,e.$(document).ready((function(){e.ready()})),e}return i(a,n),e(a,[{key:"ready",value:function(){var t=this.$("body");this.__views.forEach((function(n){var e=n.classNames(),i=!1;e.forEach((function(n){i||t.hasClass(n)||(i=!0)})),i||n.ready()})),this.emit("ready")}}]),a}(u),l=function(n){function a(n){var e;return t(this,a),(e=s(this,r(a).call(this))).app=n,n.on("ready",e.ready),e}return i(a,n),e(a,[{key:"ready",value:function(){}}]),a}(u),f=function(n){function a(){return t(this,a),s(this,r(a).apply(this,arguments))}return i(a,n),e(a,[{key:"check",value:function(t){var n=this;return new Promise((function(e,i){n.emit("validating"),n.validate(t).then((function(t){n.emit("valid"),e(t)})).catch((function(t){n.emit("invalid",t),i(t)}))}))}},{key:"validate",value:function(){throw new Error("Method not implemented")}}]),a}(u),d=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,h=function(n){function a(){return t(this,a),s(this,r(a).apply(this,arguments))}return i(a,n),e(a,[{key:"validate",value:function(t){return new Promise((function(n,e){var i=String(t).toLowerCase();d.test(i)?n(i):e(new Error("This doesn't look like an email address."))}))}}]),a}(f),v=function(n){function a(n){var e;return t(this,a),(e=s(this,r(a).call(this))).basis=n,e}return i(a,n),e(a,[{key:"validate",value:function(t){var n=this;return new Promise((function(e,i){var r=new WebSocket("ws://".concat(window.location.host,"/ws/unique/").concat(n.basis,"/")),a=!1,o=!1;r.onclose=function(){o||a||i(new Error("An error occurred while communicating with the server."))},r.onmessage=function(n){var s=JSON.parse(n.data);s.valid?o||a||(a=!0,r.close(),e(t)):o||a||(o=!0,r.close(),i(new Error(s.error)))},r.onopen=function(){r.send(t)}}))}}]),a}(f),p=function(n){function a(n){var e;return t(this,a),(e=s(this,r(a).call(this))).checkAgainst=n,e}return i(a,n),e(a,[{key:"validate",value:function(t){var n=this;return new Promise((function(e,i){t!==n.checkAgainst?i(new Error("This value doesn't match the previous one.")):e(t)}))}}]),a}(f),w=function(n){function a(n){var e;return t(this,a),(e=s(this,r(a).call(this))).basis=n,e}return i(a,n),e(a,[{key:"validate",value:function(t){var n=this;return new Promise((function(e,i){var r=new WebSocket("ws://".concat(window.location.host,"/ws/validate/").concat(n.basis,"/")),a=!1,o=!1;r.onclose=function(){o||a||i(new Error("An error occurred while communicating with the server."))},r.onmessage=function(n){var s=JSON.parse(n.data);s.valid?o||a||(a=!0,r.close(),e(t)):o||a||(o=!0,r.close(),i(new Error(s.error)))},r.onopen=function(){r.send(t)}}))}}]),a}(f),m=function(n){function e(n,i){var a;t(this,e),a=s(this,r(e).call(this));a.show=function(t){return new Promise((function(n){i.hasClass("active")&&(a.emit("shown"),n()),a.emit("showing"),t?i.addClass("showing-"+t):i.addClass("showing"),setTimeout((function(){t?i.removeClass("showing-"+t):i.removeClass("showing"),a.emit("shown"),n()}),333)}))},a.hide=function(t){return new Promise((function(n){a.emit("hiding"),t?i.addClass("hiding-"+t):i.addClass("hiding"),setTimeout((function(){t?i.removeClass("hiding-"+t):i.removeClass("hiding"),a.emit("hidden"),n()}),333)}))},a.on("showing",(function(){i.addClass("active"),i.trigger("wizard.showing")})),a.on("hidden",(function(){i.removeClass("active"),i.trigger("wizard.hidden")})),a.on("shown",(function(){i.find(":input").first().focus(),i.trigger("wizard.shown")})),a.on("validation",(function(t){if(void 0===t)return i.find(":input.is-invalid").removeClass("is-invalid"),void i.find(".invalid-feedback").remove();var n=window.$(t.field),e=n.closest(".form-group"),r=e.find(".invalid-feedback");n.addClass("is-invalid"),r.length||(r=window.$("<div>").addClass("invalid-feedback")).appendTo(e),r.text(t.message),n.focus()})),a.prev=function(){a.hide("rw").then((function(){a.emit("moving.prev"),a.emit("prev")}))},a.next=function(){var t,n,e;t=i.find('button, input[type="button"]').attr("disabled","disabled"),n=i.find(":input").not(t).not("[disabled]"),e=function(){t.removeAttr("disabled"),n.removeAttr("disabled")},n.attr("disabled","disabled"),a.on("moving.next",e),a.on("validation",(function(t){t&&e()})),a.emit("validation"),a.validate().then((function(){a.emit("moving.next"),a.hide("ff").then((function(){a.emit("next")}))})).catch((function(t){a.emit("validation",t)}))},a.validate=function(){return new Promise((function(t,n){var e=!1,r=[],a=i.closest("form");i.find(":input").each((function(){if(e)return!1;var t=window.$(this),i=t.val(),o=t.attr("required"),s=t.attr("type")||"text",u=t.attr("data-unique"),c=t.attr("data-validator"),l=t.attr("data-pair");if(o&&!i.trim())return e=!0,n({field:t,message:"This field is required."}),!1;switch(s){case"email":r.push([new h,t])}u&&r.push([new v(u),t]),c&&r.push([new w(c),t]),l&&r.push([new p(a.find(':input[name="'.concat(l,'"]')).val()),t])}));r.length?function i(){var a=r.shift(),o=a[0],s=a[1],u=s.val().trim();o.check(u).then((function(){r.length?i():e||t()})).catch((function(t){e||(e=!0,n({field:s,message:t.message}))}))}():e||t()}))};var u=o(a);return i.on("click",'[data-action="prev"]',(function(){u.prev()})),i.on("click","[data-skip]",(function(){var t=parseInt(window.$(this).data("skip"));u.hide("ff"),u.emit("skip",t)})),i.on("click",'[data-action="next"]',(function(){u.next()})),i.on("keydown",":input",(function(t){13===t.keyCode&&(t.preventDefault(),u.next())})),a}return i(e,n),e}(u),g=function(n){function e(n){var i;t(this,e);var a=o(i=s(this,r(e).call(this))),u=[];return n.find(".step").each((function(){var t=window.$(this),n=new m(a,t);t.data("wizard-step",n),u.push(n)})),u.forEach((function(t,n){n>0&&t.on("moving.prev",(function(){u[n-1].show("rw")})),n<u.length-1?t.on("moving.next",(function(){u[n+1].show("ff")})):t.on("next",(function(){i.submit()})),t.on("skip",(function(t){u[t].show("ff")}))})),i.show=function(t){void 0===t&&(t=0),n.find(".step").each((function(n){if(window.$(this).find(".form-group.is-invalid").length)return t=n,!1})),u[t].show()},i.submit=function(){n.closest("form").submit()},i}return i(e,n),e}(u),y=function(n){function a(){return t(this,a),s(this,r(a).apply(this,arguments))}return i(a,n),e(a,[{key:"ready",value:function(){var t=this.$;t(".wizard").each((function(){new g(t(this)).show()}))}}]),a}(l),b=function(n){function e(n){var i;t(this,e),i=s(this,r(e).call(this));var a=n.find('input[type="file"]'),u=a.attr("accept"),c=o(i),l=function(t){if(u){var n=new RegExp("^"+u.replace("/","\\/").replace("*",".*"));if(!t.type.match(n))return!1}return!0};return n.on("dragenter",(function(t){t.preventDefault(),n.addClass("active"),i.emit("drag.enter")})).on("dragleave",(function(t){t.preventDefault(),n.removeClass("active"),i.emit("drag.exit")})).on("dragover",(function(t){t.preventDefault(),n.addClass("active"),i.emit("drag.over")})).on("drop",(function(t){if(t.preventDefault(),1===t.originalEvent.dataTransfer.files.length){var n=0;for(n=0;n<t.originalEvent.dataTransfer.files.length;n++)if(!l(t.originalEvent.dataTransfer.files[n]))return void i.emit("error",new Error("The dragged file was not of the correct type."));t.originalEvent.dataTransfer.files&&(a.get(0).files=t.originalEvent.dataTransfer.files,a.trigger("change"))}})).on("click",(function(t){t.target!==a.get(0)&&(t.preventDefault(),a.get(0).click())})),a.on("change",(function(){var t=0;for(t=0;t<this.files.length;t++)c.emit("file",this.files[t])})),i}return i(e,n),e}(u),k=function(n){function e(n){var i;return t(this,e),(i=s(this,r(e).call(this,n))).on("error",(function(){alert("Only images are supported here.")})),i.on("file",(function(t){var e=new FileReader;e.onload=function(t){n.css("background-image","url(".concat(t.target.result,")"))},e.readAsDataURL(t)})),i}return i(e,n),e}(b),C=function(n){function a(){return t(this,a),s(this,r(a).apply(this,arguments))}return i(a,n),e(a,[{key:"ready",value:function(){var t=this.$;t(".dropzone").each((function(){var n=t(this);n.hasClass("dropzone-image")?new k(n):new b(n)}))}}]),a}(l),_=function(t,n){void 0===n&&(n=333);var e=null,i=[],r=function(){t.apply(t,i),e=null};return function(){for(var t=arguments.length,a=new Array(t),o=0;o<t;o++)a[o]=arguments[o];i=a,null===e&&(e=setTimeout(r,n))}},E=function(n){function e(n){var i;return t(this,e),(i=s(this,r(e).call(this))).data=n,i.attach=function(t){var e=window.$("<a>").addClass("typeahead-item").addClass("list-group-item").attr("href","javascript:;");if(n.thumbnail){var r=window.$("<div>").addClass("d-flex w-100"),a=window.$("<img>").attr("src",n.thumbnail).attr("height","30").addClass("mr-3"),o=window.$("<span>").text(n.label);a.appendTo(r),o.appendTo(r),r.appendTo(e)}else e.text(n.label);e.on("click",(function(){i.select()})),e.appendTo(t),i.focus=function(){e.addClass("active").addClass("list-item-active"),i.emit("focused")},i.blur=function(){e.removeClass("active").removeClass("list-item-active"),i.emit("blurred")},i.select=function(){e.addClass("active").addClass("list-item-active"),i.emit("selected")}},i.focus=function(){throw new Error("List item not attached to container DOM element.")},i.blur=function(){throw new Error("List item not attached to container DOM element.")},i}return i(e,n),e}(u),x=function(n){function e(n){var i;return t(this,e),(i=s(this,r(e).call(this))).attach=function(t){var e=window.$("<div>").addClass("typeahead-container").addClass("list-group"),r=t.offset(),a=null,o=[];n.forEach((function(t,n){var r=new E(t);r.index=n,r.on("focused",(function(){a!==r&&(null!==a&&a.blur(),a=r)})),r.on("selected",(function(){i.emit("selected",r)})),o.push(r),r.attach(e)})),e.css({position:"absolute",top:r.top+t.outerHeight(!0),left:r.left,width:t.outerWidth(!0)}),window.$("body").append(e),i.detatch=function(){e.remove()},i.moveUp=function(){var t=null;null!==a&&(t=a.index),t=null===t?n.length-1:Math.max(0,t-1),i.focus(t)},i.moveDown=function(){var t=null;null!==a&&(t=a.index),t=null===t?0:Math.min(n.length-1,t+1),i.focus(t)},i.focus=function(t){if(void 0===t)throw new Error("Expected index of item to select.");void 0!==o[t]?o[t].focus():(null!==a&&a.blur(),a=null)},i.select=function(){null!==a&&a.select()}},i.detatch=function(){throw new Error("List has not been attached to a DOM element.")},i}return i(e,n),e}(u),$=function(n){function e(n,i,a){var o;t(this,e),o=s(this,r(e).call(this));var u=n.attr("name"),c=window.$("<input>").attr("name",u).attr("type","hidden");n.removeAttr("name"),n.after(c);var l=new _((function(t){var e=i.replace("%s",encodeURIComponent(t));window.$.getJSON(e,(function(t){var e=a(t),i=new x(e);n.data("typeahed-list")&&n.data("typeahed-list").detatch(),o.on("move.up",(function(){i.moveUp()})),o.on("move.down",(function(){i.moveDown()})),o.on("select",(function(){i.select()})),i.on("selected",(function(t){c.val(t.data.id),n.val(t.data.label),i.detatch(),n.focus()})),i.attach(n),n.data("typeahed-list",i)}))}),900);return n.on("input",(function(){return l(n.val())})),n.on("keydown",(function(t){switch(t.keyCode){case 40:t.preventDefault(),o.emit("move.down");break;case 38:t.preventDefault(),o.emit("move.up");break;case 13:t.preventDefault(),t.stopPropagation(),o.emit("select")}})),o}return i(e,n),e}(u),A=function(t){var n=t.indexOf(".$."),e=t.substr(0,n),i=t.substr(n+3);return function(t,n){var r=n[e][t];if(void 0===r)throw new Error("Index out of range.");return r[i]}},O=function(t){var n=t.indexOf(".$."),e=t.substr(0,n);return function(t){var n=t[e];if(Array.isArray(n))return n.length;throw new Error("Value is not an array.")}},T=function n(e){t(this,n),this.transform=function(t){var n=e.id,i=e.label,r=e.thumbnail,a=n?new A(n):null,o=i?new A(i):null,s=r?new A(r):null,u=new O(n),c=0;if(!a)throw new Error("No template provided for returning an object ID.");if(!o)throw new Error("No template provided for returning an object label.");try{c=u(t)}catch(t){throw new Error("Invalid data returned.")}var l,f,d=0,h=[];for(d=0;d<c;d++)h.push((l=d,f=void 0,(f={}).id=a(l,t),f.label=o(l,t),s&&(f.thumbnail=s(l,t)),f));return h}},D=function(n){function a(){return t(this,a),s(this,r(a).apply(this,arguments))}return i(a,n),e(a,[{key:"ready",value:function(){var t=this.$;t("input[data-typeahead-url]").each((function(){var n=t(this),e=n.data("typeahead-url"),i=new T(n.data("typeahead-transform")),r=new $(n,e,i.transform);n.removeAttr("data-typeahead-url"),n.removeAttr("data-typeahead-transform"),n.data("typeahead",r)}))}}]),a}(l),P=function(n){function a(){return t(this,a),s(this,r(a).apply(this,arguments))}return i(a,n),e(a,[{key:"classNames",value:function(){return["projects","create-project"]}},{key:"ready",value:function(){var t=this.app.$,n=t('input[name="name"]'),e=t("#id_apple_podcasts_id");e.closest(".step").on("wizard.shown",(function(){e.val()&&e.trigger("input")})),n.on("change",(function(){e.val(n.val())}))}}]),a}(function(n){function a(n){var e;return t(this,a),(e=s(this,r(a).call(this))).app=n,e}return i(a,n),e(a,[{key:"classNames",value:function(){return[]}}]),e(a,[{key:"ready",value:function(){}}]),a}(u));window.Pico=new c({plugins:[y,C,D],views:[P]})}));
//# sourceMappingURL=pico.js.map