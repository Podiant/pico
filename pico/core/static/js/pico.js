!function(n){"function"==typeof define&&define.amd?define(n):n()}((function(){"use strict";function n(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function")}function t(n,t){for(var e=0;e<t.length;e++){var i=t[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,i.key,i)}}function e(n,e,i){return e&&t(n.prototype,e),i&&t(n,i),n}function i(n,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(t&&t.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),t&&o(n,t)}function r(n){return(r=Object.setPrototypeOf?Object.getPrototypeOf:function(n){return n.__proto__||Object.getPrototypeOf(n)})(n)}function o(n,t){return(o=Object.setPrototypeOf||function(n,t){return n.__proto__=t,n})(n,t)}function a(n){if(void 0===n)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function s(n,t){return!t||"object"!=typeof t&&"function"!=typeof t?a(n):t}var c=function(){function t(){n(this,t),this.__callbacks={}}return e(t,[{key:"on",value:function(n,t){return void 0===this.__callbacks[n]&&(this.__callbacks[n]=[]),this.__callbacks[n].push(t),this}},{key:"off",value:function(n,t){var e=this.__callbacks[n];if(void 0===e)return this;var i=[];if(void 0!==t)for(var r=0;r<e.length;r++)e[r]!==t&&i.push(e[r]);return this.__callbacks[n]=i,this}},{key:"emit",value:function(n){var t=this.__callbacks[n],e=Array.from(arguments).slice(1);if(void 0!==t)for(var i=0;i<t.length;i++)t[i].apply(this,e);return this}}]),t}(),u=function(t){function o(t){var e,i=t.plugins;return n(this,o),(e=s(this,r(o).call(this))).__plugins=[],Array.isArray(i)&&i.forEach((function(n){var t=new n(a(e));e.__plugins.push(t)})),e.$=window.$,e.$(document).ready((function(){e.ready()})),e}return i(o,t),e(o,[{key:"ready",value:function(){this.emit("ready")}}]),o}(c),f=function(t){function o(t){var e;return n(this,o),e=s(this,r(o).call(this)),t.on("ready",e.ready),e}return i(o,t),e(o,[{key:"ready",value:function(){}}]),o}(c),l=function(t){function o(){return n(this,o),s(this,r(o).apply(this,arguments))}return i(o,t),e(o,[{key:"check",value:function(n){var t=this;return new Promise((function(e,i){t.emit("validating"),t.validate(n).then((function(n){t.emit("valid"),e(n)})).catch((function(n){t.emit("invalid",n),i(n)}))}))}},{key:"validate",value:function(){throw new Error("Method not implemented")}}]),o}(c),d=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,h=function(t){function o(){return n(this,o),s(this,r(o).apply(this,arguments))}return i(o,t),e(o,[{key:"validate",value:function(n){return new Promise((function(t,e){var i=String(n).toLowerCase();d.test(i)?t(i):e(new Error("This doesn't look like an email address."))}))}}]),o}(l),v=function(t){function o(t){var e;return n(this,o),(e=s(this,r(o).call(this))).basis=t,e}return i(o,t),e(o,[{key:"validate",value:function(n){var t=this;return new Promise((function(e,i){var r=new WebSocket("ws://".concat(window.location.host,"/ws/unique/").concat(t.basis,"/")),o=!1,a=!1;r.onclose=function(){a||o||i(new Error("An error occurred while communicating with the server."))},r.onmessage=function(t){var s=JSON.parse(t.data);s.valid?a||o||(o=!0,r.close(),e(n)):a||o||(a=!0,r.close(),i(new Error(s.error)))},r.onopen=function(){r.send(n)}}))}}]),o}(l),p=function(t){function o(t){var e;return n(this,o),(e=s(this,r(o).call(this))).checkAgainst=t,e}return i(o,t),e(o,[{key:"validate",value:function(n){var t=this;return new Promise((function(e,i){n!==t.checkAgainst?i(new Error("This value doesn't match the previous one.")):e(n)}))}}]),o}(l),w=function(t){function o(t){var e;return n(this,o),(e=s(this,r(o).call(this))).basis=t,e}return i(o,t),e(o,[{key:"validate",value:function(n){var t=this;return new Promise((function(e,i){var r=new WebSocket("ws://".concat(window.location.host,"/ws/validate/").concat(t.basis,"/")),o=!1,a=!1;r.onclose=function(){a||o||i(new Error("An error occurred while communicating with the server."))},r.onmessage=function(t){var s=JSON.parse(t.data);s.valid?a||o||(o=!0,r.close(),e(n)):a||o||(a=!0,r.close(),i(new Error(s.error)))},r.onopen=function(){r.send(n)}}))}}]),o}(l),m=function(t){function e(t,i){var o;n(this,e),o=s(this,r(e).call(this));o.show=function(n){return new Promise((function(t){i.hasClass("active")&&(o.emit("shown"),t()),o.emit("showing"),n?i.addClass("showing-"+n):i.addClass("showing"),setTimeout((function(){n?i.removeClass("showing-"+n):i.removeClass("showing"),o.emit("shown"),t()}),333)}))},o.hide=function(n){return new Promise((function(t){o.emit("hiding"),n?i.addClass("hiding-"+n):i.addClass("hiding"),setTimeout((function(){n?i.removeClass("hiding-"+n):i.removeClass("hiding"),o.emit("hidden"),t()}),333)}))},o.on("showing",(function(){i.addClass("active")})),o.on("hidden",(function(){i.removeClass("active")})),o.on("shown",(function(){i.find(":input").first().focus()})),o.on("validation",(function(n){if(void 0===n)return i.find(":input.is-invalid").removeClass("is-invalid"),void i.find(".invalid-feedback").remove();var t=window.$(n.field),e=t.closest(".form-group"),r=e.find(".invalid-feedback");t.addClass("is-invalid"),r.length||(r=window.$("<div>").addClass("invalid-feedback")).appendTo(e),r.text(n.message),t.focus()})),o.prev=function(){o.hide("rw").then((function(){o.emit("moving.prev"),o.emit("prev")}))},o.next=function(){var n,t,e;n=i.find('button, input[type="button"]').attr("disabled","disabled"),t=i.find(":input").not(n).not("[disabled]"),e=function(){n.removeAttr("disabled"),t.removeAttr("disabled")},t.attr("disabled","disabled"),o.on("moving.next",e),o.on("validation",(function(n){n&&e()})),o.emit("validation"),o.validate().then((function(){o.emit("moving.next"),o.hide("ff").then((function(){o.emit("next")}))})).catch((function(n){o.emit("validation",n)}))},o.validate=function(){return new Promise((function(n,t){var e=!1,r=[],o=i.closest("form");i.find(":input").each((function(){if(e)return!1;var n=window.$(this),i=n.val(),a=n.attr("required"),s=n.attr("type")||"text",c=n.attr("data-unique"),u=n.attr("data-validator"),f=n.attr("data-pair");if(a&&!i.trim())return e=!0,t({field:n,message:"This field is required."}),!1;switch(s){case"email":r.push([new h,n])}c&&r.push([new v(c),n]),u&&r.push([new w(u),n]),f&&r.push([new p(o.find(':input[name="'.concat(f,'"]')).val()),n])}));r.length?function i(){var o=r.shift(),a=o[0],s=o[1],c=s.val().trim();a.check(c).then((function(){r.length?i():e||n()})).catch((function(n){e||(e=!0,t({field:s,message:n.message}))}))}():e||n()}))};var c=a(o);return i.on("click",'[data-action="prev"]',(function(){c.prev()})),i.on("click",'[data-action="next"]',(function(){c.next()})),i.on("keydown",":input",(function(n){13===n.keyCode&&c.next()})),o}return i(e,t),e}(c),g=function(t){function e(t){var i;n(this,e);var o=a(i=s(this,r(e).call(this))),c=[];return t.find(".step").each((function(){var n=window.$(this),t=new m(o,n);n.data("wizard-step",t),c.push(t)})),c.forEach((function(n,t){t>0&&n.on("moving.prev",(function(){c[t-1].show("rw")})),t<c.length-1?n.on("moving.next",(function(){c[t+1].show("ff")})):n.on("next",(function(){i.submit()}))})),i.show=function(n){void 0===n&&(n=0),t.find(".step").each((function(t){if(window.$(this).find(".form-group.is-invalid").length)return n=t,!1})),c[n].show()},i.submit=function(){t.closest("form").submit()},i}return i(e,t),e}(c),y=function(t){function o(){return n(this,o),s(this,r(o).apply(this,arguments))}return i(o,t),e(o,[{key:"ready",value:function(){var n=this.$;n(".wizard").each((function(){new g(n(this)).show()}))}}]),o}(f),b=function(t){function e(t){var i;n(this,e),i=s(this,r(e).call(this));var o=t.find('input[type="file"]'),c=o.attr("accept"),u=a(i),f=function(n){if(c){var t=new RegExp("^"+c.replace("/","\\/").replace("*",".*"));if(!n.type.match(t))return!1}return!0};return t.on("dragenter",(function(n){n.preventDefault(),t.addClass("active"),i.emit("drag.enter")})).on("dragleave",(function(n){n.preventDefault(),t.removeClass("active"),i.emit("drag.exit")})).on("dragover",(function(n){n.preventDefault(),t.addClass("active"),i.emit("drag.over")})).on("drop",(function(n){if(n.preventDefault(),1===n.originalEvent.dataTransfer.files.length){var t=0;for(t=0;t<n.originalEvent.dataTransfer.files.length;t++)if(!f(n.originalEvent.dataTransfer.files[t]))return void i.emit("error",new Error("The dragged file was not of the correct type."));n.originalEvent.dataTransfer.files&&(o.get(0).files=n.originalEvent.dataTransfer.files,o.trigger("change"))}})).on("click",(function(n){n.target!==o.get(0)&&(n.preventDefault(),o.get(0).click())})),o.on("change",(function(){var n=0;for(n=0;n<this.files.length;n++)u.emit("file",this.files[n])})),i}return i(e,t),e}(c),k=function(t){function e(t){var i;return n(this,e),(i=s(this,r(e).call(this,t))).on("error",(function(){alert("Only images are supported here.")})),i.on("file",(function(n){var e=new FileReader;e.onload=function(n){t.css("background-image","url(".concat(n.target.result,")"))},e.readAsDataURL(n)})),i}return i(e,t),e}(b),_=function(t){function o(){return n(this,o),s(this,r(o).apply(this,arguments))}return i(o,t),e(o,[{key:"ready",value:function(){var n=this.$;n(".dropzone").each((function(){var t=n(this);t.hasClass("dropzone-image")?new k(t):new b(t)}))}}]),o}(f);window.Pico=new u({plugins:[y,_]})}));
//# sourceMappingURL=pico.js.map