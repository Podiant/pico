!function(n){"function"==typeof define&&define.amd?define(n):n()}((function(){"use strict";function n(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function")}function t(n,t){for(var i=0;i<t.length;i++){var e=t[i];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(n,e.key,e)}}function i(n,i,e){return i&&t(n.prototype,i),e&&t(n,e),n}function e(n,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(t&&t.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),t&&r(n,t)}function o(n){return(o=Object.setPrototypeOf?Object.getPrototypeOf:function(n){return n.__proto__||Object.getPrototypeOf(n)})(n)}function r(n,t){return(r=Object.setPrototypeOf||function(n,t){return n.__proto__=t,n})(n,t)}function a(n){if(void 0===n)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function s(n,t){return!t||"object"!=typeof t&&"function"!=typeof t?a(n):t}var c=function(){function t(){n(this,t),this.__callbacks={}}return i(t,[{key:"on",value:function(n,t){return void 0===this.__callbacks[n]&&(this.__callbacks[n]=[]),this.__callbacks[n].push(t),this}},{key:"off",value:function(n,t){var i=this.__callbacks[n];if(void 0===i)return this;var e=[];if(void 0!==t)for(var o=0;o<i.length;o++)i[o]!==t&&e.push(i[o]);return this.__callbacks[n]=e,this}},{key:"emit",value:function(n){var t=this.__callbacks[n],i=Array.from(arguments).slice(1);if(void 0!==t)for(var e=0;e<t.length;e++)t[e].apply(this,i);return this}}]),t}(),u=function(t){function r(t){var i,e=t.plugins;return n(this,r),(i=s(this,o(r).call(this))).__plugins=[],Array.isArray(e)&&e.forEach((function(n){var t=new n(a(i));i.__plugins.push(t)})),i.$=window.$,i.$(document).ready((function(){i.ready()})),i}return e(r,t),i(r,[{key:"ready",value:function(){this.emit("ready")}}]),r}(c),f=function(t){function r(t){var i;return n(this,r),i=s(this,o(r).call(this)),t.on("ready",i.ready),i}return e(r,t),i(r,[{key:"ready",value:function(){}}]),r}(c),l=function(t){function r(){return n(this,r),s(this,o(r).apply(this,arguments))}return e(r,t),i(r,[{key:"check",value:function(n){var t=this;return new Promise((function(i,e){t.emit("validating"),t.validate(n).then((function(n){t.emit("valid"),i(n)})).catch((function(n){t.emit("invalid",n),e(n)}))}))}},{key:"validate",value:function(){throw new Error("Method not implemented")}}]),r}(c),d=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,h=function(t){function r(){return n(this,r),s(this,o(r).apply(this,arguments))}return e(r,t),i(r,[{key:"validate",value:function(n){return new Promise((function(t,i){var e=String(n).toLowerCase();d.test(e)?t(e):i(new Error("This doesn't look like an email address."))}))}}]),r}(l),v=function(t){function r(t){var i;return n(this,r),(i=s(this,o(r).call(this))).basis=t,i}return e(r,t),i(r,[{key:"validate",value:function(n){var t=this;return new Promise((function(i,e){var o=new WebSocket("ws://".concat(window.location.host,"/ws/unique/").concat(t.basis,"/")),r=!1,a=!1;o.onclose=function(){a||r||e(new Error("An error occurred while communicating with the server."))},o.onmessage=function(t){var s=JSON.parse(t.data);s.valid?a||r||(r=!0,o.close(),i(n)):a||r||(a=!0,o.close(),e(new Error(s.error)))},o.onopen=function(){o.send(n)}}))}}]),r}(l),w=function(t){function r(t){var i;return n(this,r),(i=s(this,o(r).call(this))).checkAgainst=t,i}return e(r,t),i(r,[{key:"validate",value:function(n){var t=this;return new Promise((function(i,e){n!==t.checkAgainst?e(new Error("This value doesn't match the previous one.")):i(n)}))}}]),r}(l),p=function(t){function r(t){var i;return n(this,r),(i=s(this,o(r).call(this))).basis=t,i}return e(r,t),i(r,[{key:"validate",value:function(n){var t=this;return new Promise((function(i,e){var o=new WebSocket("ws://".concat(window.location.host,"/ws/validate/").concat(t.basis,"/")),r=!1,a=!1;o.onclose=function(){a||r||e(new Error("An error occurred while communicating with the server."))},o.onmessage=function(t){var s=JSON.parse(t.data);s.valid?a||r||(r=!0,o.close(),i(n)):a||r||(a=!0,o.close(),e(new Error(s.error)))},o.onopen=function(){o.send(n)}}))}}]),r}(l),m=function(t){function i(t,e){var r;n(this,i),r=s(this,o(i).call(this));r.show=function(n){return new Promise((function(t){e.hasClass("active")&&(r.emit("shown"),t()),r.emit("showing"),n?e.addClass("showing-"+n):e.addClass("showing"),setTimeout((function(){n?e.removeClass("showing-"+n):e.removeClass("showing"),r.emit("shown"),t()}),333)}))},r.hide=function(n){return new Promise((function(t){r.emit("hiding"),n?e.addClass("hiding-"+n):e.addClass("hiding"),setTimeout((function(){n?e.removeClass("hiding-"+n):e.removeClass("hiding"),r.emit("hidden"),t()}),333)}))},r.on("showing",(function(){e.addClass("active")})),r.on("hidden",(function(){e.removeClass("active")})),r.on("shown",(function(){e.find(":input").first().focus()})),r.on("validation",(function(n){if(void 0===n)return e.find(":input.is-invalid").removeClass("is-invalid"),void e.find(".invalid-feedback").remove();var t=window.$(n.field),i=t.closest(".form-group"),o=i.find(".invalid-feedback");t.addClass("is-invalid"),o.length||(o=window.$("<div>").addClass("invalid-feedback")).appendTo(i),o.text(n.message),t.focus()})),r.prev=function(){r.hide("rw").then((function(){r.emit("moving.prev"),r.emit("prev")}))},r.next=function(){var n,t,i;n=e.find('button, input[type="button"]').attr("disabled","disabled"),t=e.find(":input").not(n).not("[disabled]"),i=function(){n.removeAttr("disabled"),t.removeAttr("disabled")},t.attr("disabled","disabled"),r.on("moving.next",i),r.on("validation",(function(n){n&&i()})),r.emit("validation"),r.validate().then((function(){r.emit("moving.next"),r.hide("ff").then((function(){r.emit("next")}))})).catch((function(n){r.emit("validation",n)}))},r.validate=function(){return new Promise((function(n,t){var i=!1,o=[],r=e.closest("form");e.find(":input").each((function(){if(i)return!1;var n=window.$(this),e=n.val(),a=n.attr("required"),s=n.attr("type")||"text",c=n.attr("data-unique"),u=n.attr("data-validator"),f=n.attr("data-pair");if(a&&!e.trim())return i=!0,t({field:n,message:"This field is required."}),!1;switch(s){case"email":o.push([new h,n])}c&&o.push([new v(c),n]),u&&o.push([new p(u),n]),f&&o.push([new w(r.find(':input[name="'.concat(f,'"]')).val()),n])}));o.length?function e(){var r=o.shift(),a=r[0],s=r[1],c=s.val().trim();a.check(c).then((function(){o.length?e():i||n()})).catch((function(n){i||(i=!0,t({field:s,message:n.message}))}))}():i||n()}))};var c=a(r);return e.on("click",'[data-action="prev"]',(function(){c.prev()})),e.on("click",'[data-action="next"]',(function(){c.next()})),e.on("keydown",":input",(function(n){13===n.keyCode&&c.next()})),r}return e(i,t),i}(c),y=function(t){function i(t){var e;n(this,i);var r=a(e=s(this,o(i).call(this))),c=[];return t.find(".step").each((function(){var n=new m(r,window.$(this));c.push(n)})),c.forEach((function(n,t){t>0&&n.on("moving.prev",(function(){c[t-1].show("rw")})),t<c.length&&n.on("moving.next",(function(){c[t+1].show("ff")}))})),e.show=function(n){void 0===n&&(n=0),c[n].show()},e}return e(i,t),i}(c),g=function(t){function r(){return n(this,r),s(this,o(r).apply(this,arguments))}return e(r,t),i(r,[{key:"ready",value:function(){var n=this.$;n(".onboarding.wizard").each((function(){new y(n(this)).show()}))}}]),r}(f);window.Pico=new u({plugins:[g]})}));
//# sourceMappingURL=pico.js.map