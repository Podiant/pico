!function(e){"function"==typeof define&&define.amd?define(e):e()}((function(){"use strict";function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function t(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function n(e,n,a){return n&&t(e.prototype,n),a&&t(e,a),e}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&i(e,t)}function r(e){return(r=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function i(e,t){return(i=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function o(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function c(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?o(e):t}var s=function(){function t(){e(this,t),this.__callbacks={}}return n(t,[{key:"on",value:function(e,t){return void 0===this.__callbacks[e]&&(this.__callbacks[e]=[]),this.__callbacks[e].push(t),this}},{key:"off",value:function(e,t){var n=this.__callbacks[e];if(void 0===n)return this;var a=[];if(void 0!==t)for(var r=0;r<n.length;r++)n[r]!==t&&a.push(n[r]);return this.__callbacks[e]=a,this}},{key:"emit",value:function(e){var t=this.__callbacks[e],n=Array.from(arguments).slice(1);if(void 0!==t)for(var a=0;a<t.length;a++)t[a].apply(this,n);return this}}]),t}(),d=function(t){function i(t){var n,a=t.plugins,s=t.views;return e(this,i),(n=c(this,r(i).call(this))).__plugins=[],n.__views=[],Array.isArray(a)&&a.forEach((function(e){var t=new e(o(n));n.__plugins.push(t)})),Array.isArray(s)&&s.forEach((function(e){var t=new e(o(n));n.__views.push(t)})),n.$=window.$,n.$(document).ready((function(){n.ready()})),n}return a(i,t),n(i,[{key:"ready",value:function(){var e=this.$("body");this.__views.forEach((function(t){var n=t.classNames(),a=!1;n.forEach((function(t){a||e.hasClass(t)||(a=!0)})),a||t.ready()})),this.emit("ready")}}]),i}(s),u=function(t){function i(t){var n;return e(this,i),(n=c(this,r(i).call(this))).app=t,t.on("ready",n.ready),n}return a(i,t),n(i,[{key:"ready",value:function(){}}]),i}(s),l=function(t){function i(){return e(this,i),c(this,r(i).apply(this,arguments))}return a(i,t),n(i,[{key:"check",value:function(e){var t=this;return new Promise((function(n,a){t.emit("validating"),t.validate(e).then((function(e){t.emit("valid"),n(e)})).catch((function(e){t.emit("invalid",e),a(e)}))}))}},{key:"validate",value:function(){throw new Error("Method not implemented")}}]),i}(s),f=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,h=function(t){function i(){return e(this,i),c(this,r(i).apply(this,arguments))}return a(i,t),n(i,[{key:"validate",value:function(e){return new Promise((function(t,n){var a=String(e).toLowerCase();f.test(a)?t(a):n(new Error("This doesn't look like an email address."))}))}}]),i}(l),v=function(t){function i(t){var n;return e(this,i),(n=c(this,r(i).call(this))).basis=t,n}return a(i,t),n(i,[{key:"validate",value:function(e){var t=this;return new Promise((function(n,a){var r=new WebSocket("ws://".concat(window.location.host,"/ws/unique/").concat(t.basis,"/")),i=!1,o=!1;r.onclose=function(){o||i||a(new Error("An error occurred while communicating with the server."))},r.onmessage=function(t){var c=JSON.parse(t.data);c.valid?o||i||(i=!0,r.close(),n(e)):o||i||(o=!0,r.close(),a(new Error(c.error)))},r.onopen=function(){r.send(e)}}))}}]),i}(l),p=function(t){function i(t){var n;return e(this,i),(n=c(this,r(i).call(this))).checkAgainst=t,n}return a(i,t),n(i,[{key:"validate",value:function(e){var t=this;return new Promise((function(n,a){e!==t.checkAgainst?a(new Error("This value doesn't match the previous one.")):n(e)}))}}]),i}(l),m=function(t){function i(t){var n;return e(this,i),(n=c(this,r(i).call(this))).basis=t,n}return a(i,t),n(i,[{key:"validate",value:function(e){var t=this;return new Promise((function(n,a){var r=new WebSocket("ws://".concat(window.location.host,"/ws/validate/").concat(t.basis,"/")),i=!1,o=!1;r.onclose=function(){o||i||a(new Error("An error occurred while communicating with the server."))},r.onmessage=function(t){var c=JSON.parse(t.data);c.valid?o||i||(i=!0,r.close(),n(e)):o||i||(o=!0,r.close(),a(new Error(c.error)))},r.onopen=function(){r.send(e)}}))}}]),i}(l),w=function(t){function n(t,a){var i;e(this,n),i=c(this,r(n).call(this));i.show=function(e){return new Promise((function(t){a.hasClass("active")&&(i.emit("shown"),t()),i.emit("showing"),e?a.addClass("showing-"+e):a.addClass("showing"),setTimeout((function(){e?a.removeClass("showing-"+e):a.removeClass("showing"),i.emit("shown"),t()}),333)}))},i.hide=function(e){return new Promise((function(t){i.emit("hiding"),e?a.addClass("hiding-"+e):a.addClass("hiding"),setTimeout((function(){e?a.removeClass("hiding-"+e):a.removeClass("hiding"),i.emit("hidden"),t()}),333)}))},i.on("showing",(function(){a.addClass("active"),a.trigger("wizard.showing")})),i.on("hidden",(function(){a.removeClass("active"),a.trigger("wizard.hidden")})),i.on("shown",(function(){a.find(":input").first().focus(),a.trigger("wizard.shown")})),i.on("validation",(function(e){if(void 0===e)return a.find(":input.is-invalid").removeClass("is-invalid"),void a.find(".invalid-feedback").remove();var t=window.$(e.field),n=t.closest(".form-group"),r=n.find(".invalid-feedback");t.addClass("is-invalid"),r.length||(r=window.$("<div>").addClass("invalid-feedback")).appendTo(n),r.text(e.message),t.focus()})),i.prev=function(){i.hide("rw").then((function(){i.emit("moving.prev"),i.emit("prev")}))},i.next=function(){var e,t,n;e=a.find('button, input[type="button"]').attr("disabled","disabled"),t=a.find(":input").not(e).not("[disabled]"),n=function(){e.removeAttr("disabled"),t.removeAttr("disabled")},t.attr("disabled","disabled"),i.on("moving.next",n),i.on("validation",(function(e){e&&n()})),i.emit("validation"),i.validate().then((function(){i.emit("moving.next"),i.hide("ff").then((function(){i.emit("next")}))})).catch((function(e){i.emit("validation",e)}))},i.validate=function(){return new Promise((function(e,t){var n=!1,r=[],i=a.closest("form");a.find(":input").each((function(){if(n)return!1;var e=window.$(this),a=e.val(),o=e.attr("required"),c=e.attr("type")||"text",s=e.attr("data-unique"),d=e.attr("data-validator"),u=e.attr("data-pair");if(o&&!a.trim())return n=!0,t({field:e,message:"This field is required."}),!1;switch(c){case"email":r.push([new h,e])}s&&r.push([new v(s),e]),d&&r.push([new m(d),e]),u&&r.push([new p(i.find(':input[name="'.concat(u,'"]')).val()),e])}));r.length?function a(){var i=r.shift(),o=i[0],c=i[1],s=c.val().trim();o.check(s).then((function(){r.length?a():n||e()})).catch((function(e){n||(n=!0,t({field:c,message:e.message}))}))}():n||e()}))};var s=o(i);return a.on("click",'[data-action="prev"]',(function(){s.prev()})),a.on("click","[data-skip]",(function(){var e=parseInt(window.$(this).data("skip"));s.hide("ff"),s.emit("skip",e)})),a.on("click",'[data-action="next"]',(function(){s.next()})),a.on("keydown",":input",(function(e){13===e.keyCode&&(e.preventDefault(),s.next())})),i}return a(n,t),n}(s),b=function(t){function n(t){var a;e(this,n);var i=o(a=c(this,r(n).call(this))),s=[];return t.find(".step").each((function(){var e=window.$(this),t=new w(i,e);e.data("wizard-step",t),s.push(t)})),s.forEach((function(e,t){t>0&&e.on("moving.prev",(function(){s[t-1].show("rw")})),t<s.length-1?e.on("moving.next",(function(){s[t+1].show("ff")})):e.on("next",(function(){a.submit()})),e.on("skip",(function(e){s[e].show("ff")}))})),a.show=function(e){void 0===e&&(e=0),t.find(".step").each((function(t){if(window.$(this).find(".form-group.is-invalid").length)return e=t,!1})),s[e].show()},a.submit=function(){t.closest("form").submit()},a}return a(n,t),n}(s),g=function(t){function i(){return e(this,i),c(this,r(i).apply(this,arguments))}return a(i,t),n(i,[{key:"ready",value:function(){var e=this.$;e(".wizard").each((function(){new b(e(this)).show()}))}}]),i}(u),y=function(t){function n(t){var a;e(this,n),a=c(this,r(n).call(this));var i=t.find('input[type="file"]'),s=i.attr("accept"),d=o(a),u=function(e){if(s){var t=new RegExp("^"+s.replace("/","\\/").replace("*",".*"));if(!e.type.match(t))return!1}return!0};return t.on("dragenter",(function(e){e.preventDefault(),t.addClass("active"),a.emit("drag.enter")})).on("dragleave",(function(e){e.preventDefault(),t.removeClass("active"),a.emit("drag.exit")})).on("dragover",(function(e){e.preventDefault(),t.addClass("active"),a.emit("drag.over")})).on("drop",(function(e){if(e.preventDefault(),1===e.originalEvent.dataTransfer.files.length){var t=0;for(t=0;t<e.originalEvent.dataTransfer.files.length;t++)if(!u(e.originalEvent.dataTransfer.files[t]))return void a.emit("error",new Error("The dragged file was not of the correct type."));e.originalEvent.dataTransfer.files&&(i.get(0).files=e.originalEvent.dataTransfer.files,i.trigger("change"))}})).on("click",(function(e){e.target!==i.get(0)&&(e.preventDefault(),i.get(0).click())})),i.on("change",(function(){var e=0;for(e=0;e<this.files.length;e++)d.emit("file",this.files[e])})),a}return a(n,t),n}(s),k=function(t){function n(t){var a;return e(this,n),(a=c(this,r(n).call(this,t))).on("error",(function(){alert("Only images are supported here.")})),a.on("file",(function(e){var n=new FileReader;n.onload=function(e){t.css("background-image","url(".concat(e.target.result,")"))},n.readAsDataURL(e)})),a}return a(n,t),n}(y),C=function(t){function i(){return e(this,i),c(this,r(i).apply(this,arguments))}return a(i,t),n(i,[{key:"ready",value:function(){var e=this.$;e(".dropzone").each((function(){var t=e(this);t.hasClass("dropzone-image")?new k(t):new y(t)}))}}]),i}(u),E=function(e,t){void 0===t&&(t=333);var n=null,a=[],r=function(){e.apply(e,a),n=null};return function(){for(var e=arguments.length,i=new Array(e),o=0;o<e;o++)i[o]=arguments[o];a=i,null===n&&(n=setTimeout(r,t))}},x=function(t){function n(t){var a;return e(this,n),(a=c(this,r(n).call(this))).data=t,a.attach=function(e){var n=window.$("<a>").addClass("typeahead-item").addClass("list-group-item").attr("href","javascript:;");if(t.thumbnail){var r=window.$("<div>").addClass("d-flex w-100"),i=window.$("<img>").attr("src",t.thumbnail).attr("height","30").addClass("mr-3"),o=window.$("<span>").text(t.label);i.appendTo(r),o.appendTo(r),r.appendTo(n)}else n.text(t.label);n.on("click",(function(){a.select()})),n.appendTo(e),a.focus=function(){n.addClass("active").addClass("list-item-active"),a.emit("focused")},a.blur=function(){n.removeClass("active").removeClass("list-item-active"),a.emit("blurred")},a.select=function(){n.addClass("active").addClass("list-item-active"),a.emit("selected")}},a.focus=function(){throw new Error("List item not attached to container DOM element.")},a.blur=function(){throw new Error("List item not attached to container DOM element.")},a}return a(n,t),n}(s),_=function(t){function n(t){var a;return e(this,n),(a=c(this,r(n).call(this))).attach=function(e){var n=window.$("<div>").addClass("typeahead-container").addClass("list-group"),r=e.offset(),i=null,o=[];t.forEach((function(e,t){var r=new x(e);r.index=t,r.on("focused",(function(){i!==r&&(null!==i&&i.blur(),i=r)})),r.on("selected",(function(){a.emit("selected",r)})),o.push(r),r.attach(n)})),n.css({position:"absolute",top:r.top+e.outerHeight(!0),left:r.left,width:e.outerWidth(!0)}),window.$("body").append(n),a.detatch=function(){n.remove()},a.moveUp=function(){var e=null;null!==i&&(e=i.index),e=null===e?t.length-1:Math.max(0,e-1),a.focus(e)},a.moveDown=function(){var e=null;null!==i&&(e=i.index),e=null===e?0:Math.min(t.length-1,e+1),a.focus(e)},a.focus=function(e){if(void 0===e)throw new Error("Expected index of item to select.");void 0!==o[e]?o[e].focus():(null!==i&&i.blur(),i=null)},a.select=function(){null!==i&&i.select()}},a.detatch=function(){throw new Error("List has not been attached to a DOM element.")},a}return a(n,t),n}(s),z=function(t){function n(t,a,i){var o;e(this,n),o=c(this,r(n).call(this));var s=t.attr("name"),d=window.$("<input>").attr("name",s).attr("type","hidden");t.removeAttr("name"),t.after(d);var u=new E((function(e){var n=a.replace("%s",encodeURIComponent(e));window.$.getJSON(n,(function(e){var n=i(e),a=new _(n);t.data("typeahed-list")&&t.data("typeahed-list").detatch(),o.on("move.up",(function(){a.moveUp()})),o.on("move.down",(function(){a.moveDown()})),o.on("select",(function(){a.select()})),a.on("selected",(function(e){d.val(e.data.id),t.val(e.data.label),a.detatch(),t.focus()})),a.attach(t),t.data("typeahed-list",a)}))}),900);return t.on("input",(function(){return u(t.val())})),t.on("keydown",(function(e){switch(e.keyCode){case 40:e.preventDefault(),o.emit("move.down");break;case 38:e.preventDefault(),o.emit("move.up");break;case 13:d.val()||(e.preventDefault(),e.stopPropagation(),o.emit("select"))}})),o}return a(n,t),n}(s),D=function(e){var t=e.indexOf(".$."),n=e.substr(0,t),a=e.substr(t+3);return function(e,t){var r=t[n][e];if(void 0===r)throw new Error("Index out of range.");return r[a]}},j=function(e){var t=e.indexOf(".$."),n=e.substr(0,t);return function(e){var t=e[n];if(Array.isArray(t))return t.length;throw new Error("Value is not an array.")}},O=function t(n){e(this,t),this.transform=function(e){var t=n.id,a=n.label,r=n.thumbnail,i=t?new D(t):null,o=a?new D(a):null,c=r?new D(r):null,s=new j(t),d=0;if(!i)throw new Error("No template provided for returning an object ID.");if(!o)throw new Error("No template provided for returning an object label.");try{d=s(e)}catch(e){throw new Error("Invalid data returned.")}var u,l,f=0,h=[];for(f=0;f<d;f++)h.push((u=f,l=void 0,(l={}).id=i(u,e),l.label=o(u,e),c&&(l.thumbnail=c(u,e)),l));return h}},$=function(t){function i(){return e(this,i),c(this,r(i).apply(this,arguments))}return a(i,t),n(i,[{key:"ready",value:function(){var e=this.$;e("input[data-typeahead-url]").each((function(){var t=e(this),n=t.data("typeahead-url"),a=new O(t.data("typeahead-transform")),r=new z(t,n,a.transform);t.removeAttr("data-typeahead-url"),t.removeAttr("data-typeahead-transform"),t.data("typeahead",r)}))}}]),i}(u),A=function(t){function i(t){var n;return e(this,i),(n=c(this,r(i).call(this))).app=t,n}return a(i,t),n(i,[{key:"classNames",value:function(){return[]}}]),n(i,[{key:"ready",value:function(){}}]),i}(s),T=function(t){function i(){return e(this,i),c(this,r(i).apply(this,arguments))}return a(i,t),n(i,[{key:"classNames",value:function(){return["projects","create-project"]}},{key:"ready",value:function(){var e=this.app.$,t=e('input[name="name"]'),n=e("#id_apple_podcasts_id");n.closest(".step").on("wizard.shown",(function(){n.val()&&n.trigger("input")})),t.on("change",(function(){n.val(t.val())}))}}]),i}(A),P=function(t){function n(t,a){var i;e(this,n);var o=null,s=null,d=!1;(i=c(this,r(n).call(this))).connect=function(){o=new WebSocket(t);var e=function(e,t,n){var a={meta:window.$.extend({method:e},n),data:t},r=JSON.stringify(a);o.send(r)};i.create=function(t){return e("create",t)},i.update=function(t){return e("update",t)},i.update_list=function(t,n){return e("update_list",n,{type:t})},i.delete=function(t){return e("delete",t)},i.list=function(t){return e("list",t)},o.onclose=function(){o=null,u(),d&&(d=!1,i.emit("disconnected")),s=setTimeout((function(){a*=2,i.connect()}),a),console.warn("Waiting ".concat(a/1e3," second(s) for connection to be restored."))},o.onmessage=function(e){var t=JSON.parse(e.data);if(t.error)console.warn(t.error);else if(t.meta){switch(t.meta.method){case"list":return void i.emit("listed",t.meta.type,t.data);case"create":return void i.emit("created",t.meta.type,t.data);case"update":return void i.emit("updated",t.meta.type,t.data);case"update_list":return void i.emit("listed",t.meta.type,t.data);case"delete":return void i.emit("deleted",t.meta.type,t.data)}console.warn("Unrecognised response.",t.meta)}else console.warn("Missing response metadata.")},o.onopen=function(){null!==s&&(clearTimeout(s),s=null),d||(d=!0,i.emit("connected"))}};var u=function(){void 0===a&&(a=1e3),i.create=function(){throw new Error("Database not connected.")},i.update=function(){throw new Error("Database not connected.")},i.update_list=function(){throw new Error("Database not connected.")},i.delete=function(){throw new Error("Database not connected.")},i.list=function(){throw new Error("Database not connected.")},i.send=function(){throw new Error("Database not connected.")}};return u(),i}return a(n,t),n}(s),q=window.$,M=function t(n){e(this,t),this.attach=function(e){var t={info:"#17a2b8",warning:"#ffc107",danger:"#dc3545",success:"#28a745"},a=t[n];void 0===a&&(a=t.info);var r='<svg class="rounded mr-2" width="20" height="20" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="xMidYMid slice" focusable="false" role="img"><rect width="100%" height="100%" fill="'+a+'"></rect></svg>';e.append(r)}},R=function(t){function n(t){var a,i=t.type,o=t.sender,s=t.text;return e(this,n),void 0===i&&(i="info"),void 0===o&&(o="Pico"),(a=c(this,r(n).call(this))).type=i,a.sender=o,a.text=s,a.show=function(){var e=q("<div>").addClass("toast").attr("role","alert").attr("ria-live","assertive").attr("aria-atomic","true").css({position:"fixed",bottom:"15px",left:"15px","min-width":"300px"}),t=q("<div>").addClass("toast-header"),n=new M(a.type),r=q("<strong>").addClass("mr-auto").text(a.sender),i=q("<small>").text("Just now"),o=q("<butotn>").addClass("ml-2 mb-1 close").attr("data-dismiss","toast").attr("aria-label","Close").html('<span aria-hidden="true">&times;</span>').attr("href","javascript:;");n.attach(t),t.append(r),t.append(i),t.append(o),e.append(t);var c=q("<div>").addClass("toast-body");c.text(s),e.append(c),q("body").append(e),e.toast({delay:6e3}).toast("show")},a}return a(n,t),n}(s),S=window.$,N=function(t){function i(t){var n;e(this,i),(n=c(this,r(i).call(this))).accepted=!1,n.rejected=!1,n.cancelled=!1,console.debug("Requesting to add a card in",t.name);var a=setTimeout((function(){n.cancel()}),1e4);return n.on("accepted",(function(){clearTimeout(a)})),n.on("rejected",(function(){clearTimeout(a)})),n}return a(i,t),n(i,[{key:"accept",value:function(e){if(this.accepted||this.rejected||this.cancelled)throw new Error("Request is in an invalid state.");this.accepted=!0,this.emit("accepted",e)}},{key:"reject",value:function(){if(this.accepted||this.rejected||this.cancelled)throw new Error("Request is in an invalid state.");this.rejected=!0,this.emit("rejected")}},{key:"cancel",value:function(){if(this.accepted||this.rejected||this.cancelled)throw new Error("Request is in an invalid state.");this.cancelled=!0,this.emit("cancelled")}}]),i}(s),U=function(t){function n(){var t;return e(this,n),(t=c(this,r(n).call(this))).actions={},t.attach=function(e){var n=S("<div>").addClass("kanban-card card mb-3"),a=S("<div>").addClass("card-body");if(n.append(a),e.append(n),t.populate(a),Object.keys(t.actions).length){var r=S("<div>").addClass("card-footer text-right");Object.keys(t.actions).forEach((function(e){var n=t.actions[e],a=S("<a>").attr("href","javascript:;"),i=S("<i>").addClass("fa fa-".concat(n.icon||e));a.on("click",(function(t){t.preventDefault(),n.perform().then((function(t){console.debug("Performed",e,t)})).catch((function(t){console.warn("Error performing",e,t)}))})),a.addClass("text-muted"),a.append(i),r.append(a)})),n.append(r)}return t.detatch=function(){n.remove(),t.detatch=function(){throw new Error("Card has not been attached to a DOM element.")},t.freeze=function(){throw new Error("Card has not been attached to a DOM element.")},t.unfreeze=function(){throw new Error("Card has not been attached to a DOM element.")},t.emit("detatched")},t.freeze=function(){n.addClass("kanban-frozen")},t.unfreeze=function(){n.removeClass("kanban-frozen")},t.emit("attached"),n},t.populate=function(){},t.cancel=function(){t.emit("cancelled")},t.submit=function(e){t.emit("submitted",e)},t.detatch=function(){throw new Error("Card has not been attached to a DOM element.")},t.freeze=function(){throw new Error("Card has not been attached to a DOM element.")},t.unfreeze=function(){throw new Error("Card has not been attached to a DOM element.")},t}return a(n,t),n}(s),L=function(t){function n(t){var a;return e(this,n),(a=c(this,r(n).call(this,t))).populate=function(e){var n=S("<input>").attr("type","text").addClass("form-control");t.placeholder&&n.attr("placeholder",t.placeholder),n.on("keyup",(function(e){switch(e.keyCode){case 27:a.cancel();break;case 13:e.preventDefault(),a.submit(n.val())}})),e.append(n),n.focus()},a}return a(n,t),n}(U),I=function(t){function n(t){var a;return e(this,n),(a=c(this,r(n).call(this,t))).id=t.id,a.ordering=t.ordering,a.actions={delete:{icon:"trash",title:"Delete card",perform:function(){return new Promise((function(e,t){confirm("Are you sure?")?a.destroy().then((function(){e(!0)})).catch((function(e){t(e)})):e(!1)}))}}},a.populate=function(e){var n=S("<a>").attr("href",t.url).text(t.name);e.append(n)},a.destroy=function(){return new Promise((function(e){a.emit("destroy",e)}))},a.move=function(e,t){a.freeze(),a.emit("send",e,t)},a.update=function(e){t=e,a.ordering=e.ordering,a.name=e.name},a}return a(n,t),n}(U),J=function(t){function n(t,a){var i;e(this,n),(i=c(this,r(n).call(this))).id=a.id,i.name=a.name,i.on("attached",(function(){t.trigger("kanban.attached")})),i.on("cards.create.request",(function(){t.trigger("kanban.cards.create.request")}));var s=S("<h6>").text(a.name),d=S("<div>").addClass("kanban-list-container"),u=S("<div>").addClass("kanban-list-footer");if(a.can_create_cards){var l=S("<button>").addClass("btn btn-outline-primary btn-block mb-3").text("Add card");l.on("click",(function(e){if(e.preventDefault(),!l.attr("disabled")&&a.can_create_cards){var n=new N(o(i));n.on("accepted",(function(e){var n=new L(e);n.on("submitted",(function(e){n.detatch(),i.emit("cards.create.submit",{name:e})})).on("cancelled",(function(){n.detatch()})).on("attached",(function(){t.trigger("readjust")})).on("detatched",(function(){l.removeAttr("disabled"),t.trigger("readjust")})),n.attach(d)})).on("rejected",(function(e){console.warn("Request rejected.",e),l.removeAttr("disabled")})).on("cancelled",(function(){console.warn("Request was not fulfilled in time."),l.removeAttr("disabled")})),l.attr("disabled","disabled"),i.emit("cards.create.request",n)}})),u.append(l)}return t.append(s),t.append(d),t.append(u),i.canSend=function(){return a.can_move_out},i.canReceive=function(){return a.can_move_in},i.addCard=function(e){e.attach(d).data("kanban-card",e)},i.reorder=function(e){i.emit("cards.reorder",e)},i.redraw=function(){var e={},t={};d.find(".kanban-card").each((function(){var n=S(this),a=n.data("kanban-card");e[a.ordering]=n,t[a.ordering]=a,n.remove()}));var n=Object.keys(e);n.sort(),n.forEach((function(n){var a=e[n],r=t[n];a.data("kanban-card",r),d.append(a),r.unfreeze()}))},i}return a(n,t),n}(s),W=function(t){function n(t,a){var i;e(this,n),i=c(this,r(n).call(this));var o=S("<div>").addClass("kanban-column-row"),s={},d={},u=!1;i.on("freeze",(function(){console.debug("Board frozen."),t.find("a[href], button").each((function(){var e=S(this);e.data("frozen")||e.attr("disabled")||(e.attr("disabled","disabled"),e.data("frozen",!0))})),t.addClass("kanban-frozen")})).on("unfreeze",(function(){console.debug("Board unfrozen."),t.find("a[href], button").each((function(){var e=S(this);e.data("frozen")&&(e.removeAttr("disabled"),e.data("frozen",!1))})),t.removeClass("kanban-frozen")})),t.append(o),i.emit("freeze");var l=function(){var e=0;u&&(o.find(".kanban-column").each((function(){var t=S(this).outerHeight(!0);e=Math.max(e,t)})),t.height(e))},f=function(e){var t=e.attributes.column,n=s[t];if(n){var a=S.extend({id:e.id,url:e.links.detail},e.attributes),r=new I(a);r.on("attached",l).on("detatched",l).on("send",(function(e,t){r.freeze(),h.update({type:"cards",id:r.id,attributes:{column:t.id}})})).on("destroy",(function(t){console.debug("Destroying card.",e.id),h.delete({type:"cards",id:e.id}),t()})),n.addCard(r),d[e.id]=r}else console.warn("Could not add card to column",t)},h=new P("ws://".concat(window.location.host,"/ws/kanban/").concat(a,"/")),v=function(e){return new R({type:"info",text:e}).show()};v.info=function(e){return new R({type:"info",text:e}).show()},v.warning=function(e){return new R({type:"warning",text:e}).show()},v.error=function(e){return new R({type:"danger",text:e}).show()},v.success=function(e){return new R({type:"success",text:e}).show()};var p=!1;return h.on("connected",(function(){console.debug("Opened a socket to the Kanban board."),h.list({type:"columns"}),p&&(p=!1,v.success("Re-established connection with the server."))})).on("disconnected",(function(){console.warn("Kanban board socket closed unexpectedly."),i.emit("error"),i.emit("freeze"),p=!0,v.error("Lost connection to the server.")})).on("listed",(function(e,t){switch(e){case"columns":return void function(e){u=!1,o.html("").css({width:0}),e.forEach((function(e){var t=S("<div>").addClass("kanban-column"),n=new J(t,S.extend({id:e.id},e.attributes));t.on("readjust",l),n.on("cards.create.request",(function(e){i.emit("cards.create.request",e,n)})).on("cards.create.submit",(function(t){h.create({type:"cards",attributes:S.extend({column:e.id},t)})})).on("cards.reorder",(function(e){var t=[];e.forEach((function(e,n){t.push({type:"cards",id:e,attributes:{ordering:n}})})),h.update_list("cards",t)})),s[e.id]=n,e.cards.forEach(f),t.data("kanban-column",n),o.append(t),n.emit("attached");var a=t.outerWidth(!0);o.width(o.width()+a+15)})),o.find(".kanban-column").on("drop",(function(e,t){var n=t.draggable.data("kanban-card"),a=t.draggable.closest(".kanban-column").data("kanban-column"),r=S(this),i=r.data("kanban-column");return null==n?(console.warning("Lost the card object."),!1):a.canSend(n)?i.canReceive(n)?(r.removeClass("kanban-can-receive").removeClass("kanban-cannot-receive"),void n.move(a,i)):(v.warning("Cards can't be moved to this column."),r.removeClass("kanban-can-receive").removeClass("kanban-cannot-receive"),!1):(r.removeClass("kanban-can-receive").removeClass("kanban-cannot-receive"),v.warning("Cards can't be moved from this column."),!1)})).on("dropover",(function(e,t){var n=t.draggable,a=n.data("kanban-card"),r=n.closest(".kanban-column"),i=r.data("kanban-column"),o=S(this),c=o.data("kanban-column");return!r.is(o)&&(i.canSend(a)&&c.canReceive(a)?void o.addClass("kanban-can-receive").removeClass("kanban-cannot-receive"):(o.removeClass("kanban-can-receive").addClass("kanban-cannot-receive"),!1))})).on("dropout",(function(){S(this).removeClass("kanban-can-receive").removeClass("kanban-cannot-receive")})).droppable(),o.find(".kanban-list-container").on("sortstart",(function(e,t){t.placeholder.height(t.item.height())})).on("sortupdate",(function(){var e=S(this).closest(".kanban-column").data("kanban-column"),t=[];S(this).find(".kanban-card").each((function(){var e=S(this).data("kanban-card");e.freeze(),t.push(e.id)})),e.reorder(t)})).sortable({placeholder:"ui-sortable-placeholder mb-3"}),i.emit("unfreeze"),u=!0,l()}(t);case"cards":return void function(e){var t={};e.forEach((function(e){var n=d[e.id];if(n.update(e.attributes),void 0!==n){var a=e.attributes.column,r=s[a];void 0!==r?t[a]=r:console.warn("Can't find column ".concat(a))}})),Object.values(t).forEach((function(e){e.redraw()}))}(t)}console.warn("Unrecognised content type.",e)})).on("created",(function(e,t){switch(e){case"cards":return void f(t)}console.warn("Unrecognised content type.",e)})).on("updated",(function(e,t){switch(e){case"cards":return void function(e){var t=d[e.id];if(void 0!==t){var n=s[e.attributes.column],a=S.extend({id:e.id,url:e.links.detail},e.attributes);t.update(a),t.detatch(),void 0!==n&&n.addCard(t)}}(t)}console.warn("Unrecognised content type.",e)})).on("deleted",(function(e,t){switch(e){case"cards":return void function(e){var t=d[e];t?t.detatch():console.warn("Could not find card with ID ".concat(e,"."))}(t.id)}console.warn("Unrecognised content type.",e)})),h.connect(),i}return a(n,t),n}(s),B=function(t){function i(){return e(this,i),c(this,r(i).apply(this,arguments))}return a(i,t),n(i,[{key:"classNames",value:function(){return["projects","board-detail"]}},{key:"ready",value:function(){var e=this.app.$;e(".kanban-board[data-id]").each((function(){var t=e(this),n=new W(t,t.data("id"));n.on("cards.create.request",(function(e){e.accept({placeholder:"Episode title"})})),t.removeAttr("data-id"),t.data("kanban-board",n)}))}}]),i}(A);window.Pico=new d({plugins:[g,C,$],views:[T,B]})}));
//# sourceMappingURL=pico.js.map